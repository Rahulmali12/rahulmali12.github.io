<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Revento Academy - NDA Math Live Test</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        :root { --primary: #1a237e; --accent: #ff6d00; --bg: #f4f6f8; }
        
        body { 
            font-family: 'Poppins', sans-serif; 
            background: var(--bg); 
            margin: 0; 
            padding: 0; 
            padding-bottom: 100px; /* ‡§ú‡§ó‡§π ‡§õ‡•ã‡•ú‡•Ä ‡§§‡§æ‡§ï‡§ø ‡§ï‡§Ç‡§ü‡•á‡§Ç‡§ü ‡§¨‡§ü‡§® ‡§ï‡•á ‡§™‡•Ä‡§õ‡•á ‡§® ‡§õ‡•Å‡§™‡•á */
        }
        
        .container { 
            max-width: 800px; 
            margin: 20px auto; 
            background: white; 
            padding: 20px; 
            border-radius: 12px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.1); 
        }
        
        header { text-align: center; margin-bottom: 20px; border-bottom: 2px solid #eee; padding-bottom: 15px; }
        .logo { color: var(--primary); font-size: 1.5rem; font-weight: bold; }
        
        /* Login Section */
        #login-section { text-align: center; padding: 40px 0; }
        .google-btn {
            background: #4285F4; color: white; border: none; padding: 12px 24px;
            font-size: 16px; border-radius: 5px; cursor: pointer; display: inline-flex; align-items: center; gap: 10px;
        }

        /* Quiz Section */
        #quiz-section { display: none; }
        .question-card { background: #f9f9f9; padding: 15px; margin-bottom: 15px; border-radius: 8px; border-left: 5px solid var(--primary); }
        .options label { display: flex; align-items: center; padding: 10px; cursor: pointer; background: white; margin-top: 5px; border-radius: 5px; border: 1px solid #eee; }
        .options input { margin-right: 10px; transform: scale(1.2); }
        .options label:hover { background: #e3f2fd; }

        /* --- MOBILE FIXED BOTTOM BAR (‡§Ø‡§π ‡§®‡§Ø‡§æ ‡§´‡•Ä‡§ö‡§∞ ‡§π‡•à) --- */
        .fixed-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: white;
            padding: 15px;
            box-shadow: 0 -4px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            gap: 10px;
            z-index: 1000;
            box-sizing: border-box;
        }

        .btn-action {
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            font-size: 1rem;
            cursor: pointer;
            flex: 1; /* ‡§¶‡•ã‡§®‡•ã‡§Ç ‡§¨‡§ü‡§® ‡§¨‡§∞‡§æ‡§¨‡§∞ ‡§ú‡§ó‡§π ‡§≤‡•á‡§Ç‡§ó‡•á */
        }

        .btn-clear { background: #eceff1; color: #37474f; }
        .btn-submit { background: var(--primary); color: white; }
        .btn-submit:active { background: #0d47a1; }

        /* Leaderboard Styling */
        #leaderboard-section { display: none; padding-bottom: 20px;}
        table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 0.9rem; }
        th { background: var(--primary); color: white; padding: 10px; text-align: left; }
        td { padding: 10px; border-bottom: 1px solid #ddd; }
        
        /* Mobile specific adjustments */
        @media (max-width: 600px) {
            .container { margin: 0; border-radius: 0; min-height: 100vh; }
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <div class="logo">RIVENTO <span style="color:var(--accent)">ACADEMY</span></div>
        <p style="font-size: 0.9rem; color: #666;">NDA Math - Vector & 3D (Live Test)</p>
    </header>

    <div id="login-section">
        <h3>Login to Start Test</h3>
        <p>‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ ‡§ú‡§æ‡§Å‡§ö: ‡§è‡§ï ‡§Ü‡§à‡§°‡•Ä ‡§∏‡•á ‡§ï‡•á‡§µ‡§≤ ‡§è‡§ï ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏‡•§</p>
        <br>
        <button class="google-btn" onclick="signInWithGoogle()">
            <i class="fab fa-google"></i> Google Login
        </button>
    </div>

    <div id="loading" style="display:none; text-align:center; padding: 50px;">
        <i class="fas fa-spinner fa-spin fa-2x" style="color:var(--primary)"></i>
        <p>Loading Profile...</p>
    </div>

    <div id="quiz-section">
        <div style="display:flex; align-items:center; gap:10px; margin-bottom:15px; background:#e8eaf6; padding:10px; border-radius:8px;">
            <img id="user-pic" src="" style="width:40px; height:40px; border-radius:50%;">
            <div>
                <strong id="user-name" style="font-size:0.9rem;">Student</strong><br>
                <small style="color:green;">‚óè Live Attempt</small>
            </div>
        </div>

        <form id="quizForm">
            <div class="question-card">
                <p><strong>Q1.</strong> If vector <b>a</b> and <b>b</b> are perpendicular, then <b>a.b</b> is?</p>
                <div class="options">
                    <label><input type="radio" name="q1" value="0"> 0</label>
                    <label><input type="radio" name="q1" value="1"> 1</label>
                    <label><input type="radio" name="q1" value="-1"> -1</label>
                    <label><input type="radio" name="q1" value="inf"> Infinity</label>
                </div>
            </div>

            <div class="question-card">
                <p><strong>Q2.</strong> What is the projection of vector i+j on k?</p>
                <div class="options">
                    <label><input type="radio" name="q2" value="1"> 1</label>
                    <label><input type="radio" name="q2" value="0"> 0</label>
                    <label><input type="radio" name="q2" value="root2"> ‚àö2</label>
                    <label><input type="radio" name="q2" value="half"> 1/2</label>
                </div>
            </div>

             <div class="question-card">
                <p><strong>Q3.</strong> Value of i^4 is?</p>
                <div class="options">
                    <label><input type="radio" name="q3" value="1"> 1</label>
                    <label><input type="radio" name="q3" value="-1"> -1</label>
                    <label><input type="radio" name="q3" value="i"> i</label>
                    <label><input type="radio" name="q3" value="-i"> -i</label>
                </div>
            </div>
            
            <p style="text-align:center; color:#888; margin-top:20px; margin-bottom: 50px;">--- End of Questions ---</p>
        </form>

        <div class="fixed-footer">
            <button type="button" class="btn-action btn-clear" onclick="clearSelection()">Clear</button>
            <button type="button" class="btn-action btn-submit" onclick="submitQuiz()">Submit Test</button>
        </div>
    </div>

    <div id="leaderboard-section">
        <div style="text-align:center; background:#fff3e0; padding:15px; border-radius:8px; margin-bottom:20px;">
            <h2 style="margin:0; color:#ef6c00;">üèÜ Result</h2>
            <p>Your Score: <span id="my-score" style="font-weight:bold; font-size:1.5rem;">-</span></p>
        </div>
        <h3>Top Rankers</h3>
        <table>
            <thead>
                <tr>
                    <th>Rank</th>
                    <th>Name</th>
                    <th>Score</th>
                </tr>
            </thead>
            <tbody id="leaderboard-body">
                </tbody>
        </table>
    </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
  import { getFirestore, doc, getDoc, setDoc, collection, query, orderBy, limit, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  // üëá ‡§Ø‡§π‡§æ‡§Å ‡§Ö‡§™‡§®‡•Ä KEY ‡§°‡§æ‡§≤‡§®‡§æ ‡§Æ‡§§ ‡§≠‡•Ç‡§≤‡§®‡§æ
  const firebaseConfig = {
     apiKey: "AIzaSyBmsqEPUnWjjb2m4g1XgEcRrxlK_dOIDfE",
  authDomain: "revento-academy.firebaseapp.com",
  databaseURL: "https://revento-academy-default-rtdb.firebaseio.com",
  projectId: "revento-academy",
  storageBucket: "revento-academy.firebasestorage.app",
  messagingSenderId: "384071300366",
  appId: "1:384071300366:web:8a95f3ec8507bc2d3b535f",
  measurementId: "G-4L8YC6J095"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);
  const provider = new GoogleAuthProvider();
  let currentUser = null;

  window.signInWithGoogle = () => {
      signInWithPopup(auth, provider).catch((error) => alert("Login Error: " + error.message));
  };

  onAuthStateChanged(auth, async (user) => {
      if (user) {
          currentUser = user;
          document.getElementById('login-section').style.display = 'none';
          document.getElementById('loading').style.display = 'block';

          const docRef = doc(db, "nda_math_scores", user.uid);
          const docSnap = await getDoc(docRef);

          document.getElementById('loading').style.display = 'none';

          if (docSnap.exists()) {
              showLeaderboard(docSnap.data().score);
          } else {
              document.getElementById('user-name').innerText = user.displayName;
              document.getElementById('user-pic').src = user.photoURL;
              document.getElementById('quiz-section').style.display = 'block';
          }
      }
  });

  window.clearSelection = () => {
      document.getElementById("quizForm").reset();
  };

  window.submitQuiz = async () => {
      if(!currentUser) return;
      if(!confirm("Are you sure you want to submit?")) return;

      let score = 0;
      let form = document.forms['quizForm'];
      
      // ANSWER KEY (Demo)
      if(form.q1.value === '0') score++;
      if(form.q2.value === '0') score++;
      if(form.q3.value === '1') score++;

      // Hide buttons immediately
      document.querySelector('.fixed-footer').style.display = 'none';

      try {
          await setDoc(doc(db, "nda_math_scores", currentUser.uid), {
              name: currentUser.displayName,
              score: score,
              timestamp: new Date()
          });
          showLeaderboard(score);
      } catch (e) {
          alert("Error: " + e.message);
      }
  };

  async function showLeaderboard(myScore) {
      document.getElementById('quiz-section').style.display = 'none';
      document.getElementById('leaderboard-section').style.display = 'block';
      document.getElementById('my-score').innerText = myScore;

      const q = query(collection(db, "nda_math_scores"), orderBy("score", "desc"), limit(20));
      const querySnapshot = await getDocs(q);
      
      let tbody = document.getElementById('leaderboard-body');
      tbody.innerHTML = "";
      let rank = 1;
      querySnapshot.forEach((doc) => {
          let data = doc.data();
          let style = rank === 1 ? 'background:#fff9c4; font-weight:bold;' : '';
          tbody.innerHTML += `<tr style="${style}"><td>#${rank}</td><td>${data.name}</td><td>${data.score}</td></tr>`;
          rank++;
      });
  }
</script>

</body>
</html>
