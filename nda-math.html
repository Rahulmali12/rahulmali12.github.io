<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Rivento Academy - NDA Mission</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;800&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        /* --- Theme Colors --- */
        :root { 
            --primary-dark: #0d1b42; /* Deep Navy Blue */
            --primary-light: #1a237e; 
            --accent-gold: #ffc107; /* NDA Gold */
            --text-light: #eceff1;
            --bg-grey: #eef2f5;
        }
        
        body { 
            font-family: 'Poppins', sans-serif; 
            background: var(--bg-grey); 
            margin: 0; 
            padding: 0; 
            padding-bottom: 100px; /* Space for fixed buttons */
        }

        /* --- NEW HERO HEADER (‡§ñ‡§§‡§∞‡§®‡§æ‡§ï ‡§≤‡•Å‡§ï) --- */
        .hero-header {
            /* ‡§Æ‡§ø‡§≤‡§ø‡§ü‡•ç‡§∞‡•Ä ‡§ú‡•á‡§ü ‡§¨‡•à‡§ï‡§ó‡•ç‡§∞‡§æ‡§â‡§Ç‡§° ‡§á‡§Æ‡•á‡§ú - ‡§Ü‡§™ ‡§á‡§∏‡•á ‡§¨‡§¶‡§≤ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç */
            background: linear-gradient(135deg, rgba(13, 27, 66, 0.9), rgba(26, 35, 126, 0.8)), url('https://images.unsplash.com/photo-1588989225010-8c63d1e4405a?q=80&w=1000&auto=format&fit=crop');
            background-size: cover;
            background-position: center;
            color: white;
            text-align: center;
            padding: 60px 20px 80px 20px; /* ‡§®‡•Ä‡§ö‡•á ‡§ú‡•ç‡§Ø‡§æ‡§¶‡§æ ‡§™‡•à‡§°‡§ø‡§Ç‡§ó ‡§¶‡•Ä ‡§π‡•à ‡§ì‡§µ‡§∞‡§≤‡•à‡§™ ‡§ï‡•á ‡§≤‡§ø‡§è */
            border-bottom-left-radius: 40px;
            border-bottom-right-radius: 40px;
            box-shadow: 0 15px 30px rgba(0,0,0,0.4);
            position: relative;
            z-index: 1;
        }

        .brand-title {
            font-family: 'Montserrat', sans-serif;
            font-size: 2.2rem;
            font-weight: 800;
            letter-spacing: 1px;
            margin: 0;
            text-shadow: 2px 2px 5px rgba(0,0,0,0.5);
        }
        .brand-accent { color: var(--accent-gold); }
        
        .mission-tagline {
            font-size: 1.1rem;
            font-weight: 300;
            letter-spacing: 2px;
            color: rgba(255,255,255,0.8);
            margin-top: 10px;
            text-transform: uppercase;
        }
        
        /* --- MAIN CONTAINER (‡§ì‡§µ‡§∞‡§≤‡•à‡§™ ‡§á‡§´‡•á‡§ï‡•ç‡§ü ‡§ï‡•á ‡§∏‡§æ‡§•) --- */
        .container { 
            max-width: 800px; 
            margin: -50px auto 20px auto; /* -50px ‡§á‡§∏‡•á ‡§ä‡§™‡§∞ ‡§ñ‡•Ä‡§Ç‡§ö‡§§‡§æ ‡§π‡•à */
            background: white; 
            padding: 30px; 
            border-radius: 20px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.1); 
            position: relative;
            z-index: 2;
            width: 90%; /* ‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§™‡§∞ ‡§∏‡§æ‡§á‡§° ‡§Æ‡•á‡§Ç ‡§•‡•ã‡§°‡§º‡•Ä ‡§ú‡§ó‡§π */
        }

        /* Login Section Styling */
        #login-section { text-align: center; padding: 20px 0; }
        #login-section h3 {
            color: var(--primary-dark);
            font-weight: 700;
            font-size: 1.5rem;
            margin-bottom: 10px;
        }
        .security-note {
            background: #fff3cd; color: #856404;
            display: inline-block; padding: 5px 15px; border-radius: 20px; font-size: 0.85rem; font-weight: 600;
        }

        .google-btn {
            background: #4285F4; color: white; border: none; padding: 15px 30px;
            font-size: 16px; border-radius: 50px; cursor: pointer; display: inline-flex; align-items: center; gap: 15px;
            font-weight: 600; box-shadow: 0 4px 15px rgba(66, 133, 244, 0.4); transition: transform 0.2s;
            margin-top: 25px;
        }
        .google-btn:active { transform: scale(0.98); }
        .google-btn i { background: white; color: #4285F4; padding: 8px; border-radius: 50%; }

        /* Quiz Section & Rest of the CSS */
        #quiz-section, #leaderboard-section, #loading { display: none; }
        .question-card { background: #f8f9fa; padding: 20px; margin-bottom: 20px; border-radius: 12px; border-left: 6px solid var(--accent-gold); box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .question-card p strong { color: var(--primary-dark); font-size: 1.1rem; }
        .options label { display: flex; align-items: center; padding: 12px; cursor: pointer; background: white; margin-top: 8px; border-radius: 8px; border: 2px solid #eee; transition: 0.2s; }
        .options input { margin-right: 15px; transform: scale(1.3); accent-color: var(--primary-light); }
        .options label:hover { background: #e8eaf6; border-color: var(--primary-light); }

        /* MOBILE FIXED BOTTOM BAR */
        .fixed-footer {
            position: fixed; bottom: 0; left: 0; width: 100%; background: white;
            padding: 15px; box-shadow: 0 -4px 20px rgba(0,0,0,0.15);
            display: flex; gap: 10px; z-index: 1000; box-sizing: border-box;
        }
        .btn-action { padding: 15px; border: none; border-radius: 12px; font-weight: bold; font-size: 1rem; cursor: pointer; flex: 1; text-transform: uppercase; letter-spacing: 1px;}
        .btn-clear { background: #eceff1; color: #37474f; }
        .btn-submit { background: linear-gradient(45deg, var(--primary-light), var(--primary-dark)); color: white; box-shadow: 0 4px 15px rgba(0,0,0,0.2); }

        /* Leaderboard Table */
        table { width: 100%; border-collapse: separate; border-spacing: 0 10px; margin-top: 20px; }
        th { color: var(--primary-dark); font-weight: 800; padding: 10px; text-align: left; text-transform: uppercase; font-size: 0.9rem; }
        td { padding: 15px; background: white; border-top: 1px solid #eee; border-bottom: 1px solid #eee; font-weight: 600; }
        td:first-child { border-top-left-radius: 10px; border-bottom-left-radius: 10px; border-left: 1px solid #eee; }
        td:last-child { border-top-right-radius: 10px; border-bottom-right-radius: 10px; border-right: 1px solid #eee; color: var(--accent-gold); font-weight: 800; }
        .rank-1 td { background: linear-gradient(45deg, #fff9c4, #fff); border: 1px solid #fdd835 !important; }

        @media (max-width: 600px) {
             .hero-header { padding: 40px 20px 70px 20px; }
             .brand-title { font-size: 1.8rem; }
             .container { width: 92%; margin-top: -40px; padding: 20px; }
        }
    </style>
</head>
<body>

<div class="hero-header">
    <h1 class="brand-title">RIVENTO <span class="brand-accent">ACADEMY</span></h1>
    <p class="mission-tagline"><i class="fas fa-jet-fighter"></i> Mission NDA Khadakwasla</p>
</div>

<div class="container">
    
    <div id="login-section">
        <div style="margin-bottom: 20px;">
             <i class="fas fa-shield-alt fa-3x" style="color:var(--primary-light);"></i>
        </div>
        <h3>Maths Brahmastra Test</h3>
        <p style="color:#666;">Vector Algebra & 3D Geometry</p>
        <br>
        <div class="security-note">
            <i class="fas fa-lock"></i> One Candidate, One Attempt Only.
        </div>
        <br>
        <button class="google-btn" onclick="signInWithGoogle()">
            <i class="fab fa-google"></i> Start Secure Test
        </button>
    </div>

    <div id="loading" style="text-align:center; padding: 50px;">
        <i class="fas fa-circle-notch fa-spin fa-3x" style="color:var(--accent-gold)"></i>
        <p style="margin-top:20px; font-weight:600;">Verifying Candidate...</p>
    </div>

    <div id="quiz-section">
        <div style="display:flex; align-items:center; gap:15px; margin-bottom:25px; background: #e8eaf6; padding:15px; border-radius:15px; border: 2px dashed var(--primary-light);">
            <img id="user-pic" src="" style="width:50px; height:50px; border-radius:50%; border: 3px solid white; box-shadow: 0 2px 5px rgba(0,0,0,0.2);">
            <div>
                <strong id="user-name" style="font-size:1rem; color:var(--primary-dark);">Cadet Name</strong><br>
                <small style="color:green; font-weight:600;"><i class="fas fa-broadcast-tower"></i> Live Attempt In Progress</small>
            </div>
        </div>

        <form id="quizForm">
            <div class="question-card">
                <p><strong>Q1.</strong> If |a|=3, |b|=4 and |a√ób|=10, then what is |a.b|¬≤?</p>
                <div class="options">
                    <label><input type="radio" name="q1" value="22"> 22</label>
                    <label><input type="radio" name="q1" value="44"> 44</label>
                    <label><input type="radio" name="q1" value="144"> 144</label>
                    <label><input type="radio" name="q1" value="12"> 12</label>
                </div>
            </div>
            <div class="question-card">
                <p><strong>Q2.</strong> What is the value of i^2026?</p>
                <div class="options">
                    <label><input type="radio" name="q2" value="1"> 1</label>
                    <label><input type="radio" name="q2" value="-1"> -1</label>
                    <label><input type="radio" name="q2" value="i"> i</label>
                    <label><input type="radio" name="q2" value="-i"> -i</label>
                </div>
            </div>
            
            <p style="text-align:center; color:#888; margin: 30px 0 60px 0; font-weight: 600; letter-spacing: 1px;">*** END OF PAPER ***</p>
        </form>

        <div class="fixed-footer">
            <button type="button" class="btn-action btn-clear" onclick="clearSelection()"><i class="fas fa-eraser"></i> Clear</button>
            <button type="button" class="btn-action btn-submit" onclick="submitQuiz()">Submit Test <i class="fas fa-paper-plane"></i></button>
        </div>
    </div>

    <div id="leaderboard-section">
        <div style="text-align:center; background: linear-gradient(45deg, var(--primary-dark), var(--primary-light)); color:white; padding:25px; border-radius:15px; margin-bottom:30px; box-shadow: 0 5px 15px rgba(26, 35, 126, 0.3);">
            <i class="fas fa-trophy fa-3x" style="color:var(--accent-gold); margin-bottom: 10px;"></i>
            <h2 style="margin:0; font-weight: 800; letter-spacing: 1px;">RESULT DECLARED</h2>
            <p style="margin-top:10px; font-size: 1.1rem;">Your Score: <span id="my-score" style="font-weight:800; font-size:1.8rem; color:var(--accent-gold);"></span>/2</p>
        </div>
        
        <h3 style="color:var(--primary-dark); text-transform: uppercase; letter-spacing: 1px;"><i class="fas fa-list-ol"></i> Top Commanders List</h3>
        <table>
            <thead>
                <tr>
                    <th>Rank</th>
                    <th>Cadet Name</th>
                    <th>Score</th>
                </tr>
            </thead>
            <tbody id="leaderboard-body">
                </tbody>
        </table>
    </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
  import { getFirestore, doc, getDoc, setDoc, collection, query, orderBy, limit, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  // üëáüëáüëá ‡§Ö‡§™‡§®‡•Ä FIREBASE CONFIG ‡§Ø‡§π‡§æ‡§Å ‡§™‡•á‡§∏‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç üëáüëáüëá
  const firebaseConfig = {
    apiKey: "AIzaSyBmsqEPUnWjjb2m4g1XgEcRrxlK_dOIDfE",
  authDomain: "revento-academy.firebaseapp.com",
  databaseURL: "https://revento-academy-default-rtdb.firebaseio.com",
  projectId: "revento-academy",
  storageBucket: "revento-academy.firebasestorage.app",
  messagingSenderId: "384071300366",
  appId: "1:384071300366:web:8a95f3ec8507bc2d3b535f",
  measurementId: "G-4L8YC6J095"
  };
  // üëÜüëÜüëÜüëÜüëÜüëÜüëÜüëÜüëÜüëÜ

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);
  const provider = new GoogleAuthProvider();
  let currentUser = null;

  window.signInWithGoogle = () => {
      signInWithPopup(auth, provider).catch((error) => alert("Login Error: " + error.message));
  };

  onAuthStateChanged(auth, async (user) => {
      if (user) {
          currentUser = user;
          document.getElementById('login-section').style.display = 'none';
          document.getElementById('loading').style.display = 'block';

          const docRef = doc(db, "nda_math_scores", user.uid);
          const docSnap = await getDoc(docRef);

          document.getElementById('loading').style.display = 'none';

          if (docSnap.exists()) {
              showLeaderboard(docSnap.data().score);
          } else {
              document.getElementById('user-name').innerText = user.displayName;
              document.getElementById('user-pic').src = user.photoURL;
              document.getElementById('quiz-section').style.display = 'block';
          }
      }
  });

  window.clearSelection = () => {
      document.getElementById("quizForm").reset();
  };

  window.submitQuiz = async () => {
      if(!currentUser) return;
      if(!confirm("Are you sure you want to submit? Final Answer.")) return;

      let score = 0;
      let form = document.forms['quizForm'];
      
      // ANSWER KEY (Corrected Logic for demo)
      // Q1: If |a|=3, |b|=4, |axb|=10. We know |axb|¬≤ + |a.b|¬≤ = (|a||b|)¬≤
      // 10¬≤ + |a.b|¬≤ = (3*4)¬≤  => 100 + |a.b|¬≤ = 144 => |a.b|¬≤ = 44. (Option 2 is correct)
      if(form.q1.value === '44') score++;
      
      // Q2: i^2026. 2026/4 gives remainder 2. So i^2 = -1. (Option 2 is correct)
      if(form.q2.value === '-1') score++;

      document.querySelector('.fixed-footer').style.display = 'none';

      try {
          await setDoc(doc(db, "nda_math_scores", currentUser.uid), {
              name: currentUser.displayName,
              score: score,
              timestamp: new Date()
          });
          showLeaderboard(score);
      } catch (e) {
          alert("Error submitting: " + e.message);
          document.querySelector('.fixed-footer').style.display = 'flex'; // Show buttons back if error
      }
  };

  async function showLeaderboard(myScore) {
      document.getElementById('quiz-section').style.display = 'none';
      document.getElementById('leaderboard-section').style.display = 'block';
      document.getElementById('my-score').innerText = myScore;

      const q = query(collection(db, "nda_math_scores"), orderBy("score", "desc"), limit(20));
      const querySnapshot = await getDocs(q);
      
      let tbody = document.getElementById('leaderboard-body');
      tbody.innerHTML = "";
      let rank = 1;
      querySnapshot.forEach((doc) => {
          let data = doc.data();
          let rowClass = rank === 1 ? 'rank-1' : '';
          let medal = rank === 1 ? 'ü•á' : (rank === 2 ? 'ü•à' : (rank === 3 ? 'ü•â' : `#${rank}`));
          
          tbody.innerHTML += `<tr class="${rowClass}">
            <td>${medal}</td>
            <td>${data.name}</td>
            <td>${data.score}</td>
          </tr>`;
          rank++;
      });
  }
</script>

</body>
</html>
