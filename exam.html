<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Revento Academy | Exam Portal</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    
    <style>
        /* --- PROFESSIONAL DESIGN --- */
        body { font-family: 'Poppins', sans-serif; background: #f3f4f6; margin: 0; display: flex; flex-direction: column; min-height: 100vh; user-select: none; }
        .hidden { display: none !important; }

        /* Footer */
        footer { margin-top: auto; background: #1f2937; color: #9ca3af; text-align: center; padding: 15px; font-size: 14px; }

        /* Card Design */
        .glass-card {
            background: white; border-radius: 15px; padding: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin: 20px auto;
            max-width: 600px; text-align: center;
        }

        /* Dashboard */
        .grid-menu { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; padding: 20px; }
        .btn-card {
            background: white; padding: 20px; border-radius: 10px; cursor: pointer;
            border: 2px solid transparent; box-shadow: 0 2px 5px rgba(0,0,0,0.05); transition: 0.2s;
        }
        .btn-card:hover { border-color: #4f46e5; transform: translateY(-5px); }
        
        /* Exam Interface (CBT Mode) */
        #exam-interface { display: flex; flex-direction: column; height: 100vh; background: white; }
        .top-bar { padding: 10px 20px; background: #1f2937; color: white; display: flex; justify-content: space-between; align-items: center; }
        .content-area { flex: 1; display: flex; overflow: hidden; }
        .question-box { flex: 3; padding: 30px; overflow-y: auto; }
        .sidebar { width: 280px; background: #f3f4f6; border-left: 1px solid #ccc; padding: 10px; overflow-y: auto; }
        
        /* Palette Buttons */
        .palette { display: grid; grid-template-columns: repeat(5, 1fr); gap: 5px; }
        .p-btn { width: 35px; height: 35px; border: 1px solid #ccc; background: white; cursor: pointer; border-radius: 5px; font-weight: bold; }
        .ans { background: #10b981; color: white; border: none; } /* Green */
        .not-ans { background: #ef4444; color: white; border: none; } /* Red */
        
        /* Result Table */
        .result-table { width: 100%; margin-top: 15px; border-collapse: collapse; }
        .result-table td { padding: 8px; border-bottom: 1px solid #eee; text-align: left; }
        
        /* Mobile */
        @media(max-width: 768px) {
            .content-area { flex-direction: column; }
            .sidebar { width: 100%; height: 150px; order: -1; }
        }
    </style>
</head>
<body>

    <div id="login-screen" style="height: 100vh; display: flex; align-items: center; justify-content: center; flex-direction: column;">
        <div class="glass-card">
            <h1 style="color: #4f46e5;">Revento Academy</h1>
            <p>Airforce X | Class 10 | Class 12</p>
            <button onclick="googleLogin()" style="padding: 12px 30px; background: #db4437; color: white; border: none; border-radius: 50px; font-size: 16px; cursor: pointer;">
                Login with Google
            </button>
        </div>
        <p style="margin-top: 20px; color: #666; font-size: 12px;">Developed by Rahul Mali</p>
    </div>

    <div id="dashboard" class="hidden">
        <div style="background: #4f46e5; color: white; padding: 15px; display: flex; justify-content: space-between;">
            <span id="user-name" style="font-weight: bold;">Student</span>
            <button onclick="logout()" style="background: none; border: 1px solid white; color: white; border-radius: 20px; cursor: pointer; padding: 2px 10px;">Logout</button>
        </div>
        
        <div class="container" style="max-width: 800px; margin: 0 auto;">
            <h2 style="text-align: center; margin-top: 30px;">Select Exam Category</h2>
            <div class="grid-menu">
                <div class="btn-card" onclick="showSubjects('class10')">
                    <div style="font-size: 30px;">üè´</div>
                    <h3>Class 10th</h3>
                    <p>Maths, Science</p>
                </div>
                <div class="btn-card" onclick="showSubjects('class12')">
                    <div style="font-size: 30px;">üéì</div>
                    <h3>Class 12th</h3>
                    <p>Physics, Chemistry</p>
                </div>
                <div class="btn-card" onclick="startExam('airforce_x')" style="background: #eff6ff; border-color: #0ea5e9;">
                    <div style="font-size: 30px;">‚úàÔ∏è</div>
                    <h3>Airforce X Group</h3>
                    <p style="color:red; font-size:12px;">(Negative Marking: -0.25)</p>
                </div>
                <div class="btn-card" onclick="alert('PDF Notes Section Coming Soon!')">
                    <div style="font-size: 30px;">üìö</div>
                    <h3>PDF Notes</h3>
                    <p>Download Files</p>
                </div>
            </div>
        </div>
        <footer>¬© 2026 Revento Academy | Developed by <b>Rahul Mali</b></footer>
    </div>

    <div id="subject-screen" class="hidden glass-card">
        <h3>Select Subject</h3>
        <div id="sub-list" class="grid-menu"></div>
        <button onclick="location.reload()" style="margin-top: 20px; padding: 10px 20px;">Back</button>
    </div>

    <div id="exam-interface" class="hidden">
        <div class="top-bar">
            <span>Online Exam (CBT Mode)</span>
            <span id="timer" style="background: red; padding: 5px; border-radius: 5px;">20:00</span>
            <button onclick="submitTest()" style="background: #ef4444; color: white; border: none; padding: 5px 15px; cursor: pointer; font-weight: bold;">SUBMIT EXAM</button>
        </div>
        <div class="content-area">
            <div class="question-box">
                <h2 id="q-text">Question...</h2>
                <div id="options-box"></div>
                <br>
                <div style="display:flex; gap:10px;">
                    <button onclick="saveAndNext()" style="background: #10b981; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer;">Save & Next</button>
                    <button onclick="clearRes()" style="background: #ef4444; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer;">Clear</button>
                </div>
            </div>
            <div class="sidebar">
                <p><b>Question Palette:</b></p>
                <div id="palette-box" class="palette"></div>
                <div style="margin-top:20px; font-size:12px;">
                    <span style="display:inline-block; width:10px; height:10px; background:#10b981;"></span> Answered<br>
                    <span style="display:inline-block; width:10px; height:10px; background:white; border:1px solid #ccc;"></span> Not Visited
                </div>
            </div>
        </div>
    </div>

    <div id="result-screen" class="hidden glass-card">
        <h1>üèÜ Exam Result</h1>
        <h2 style="font-size: 40px; color: #4f46e5;"><span id="final-score">0</span> Marks</h2>
        
        <table class="result-table">
            <tr><td>‚úÖ Total Questions:</td><td><b id="r-total">0</b></td></tr>
            <tr><td>üéØ Attempted:</td><td><b id="r-att">0</b></td></tr>
            <tr><td>üü¢ Correct:</td><td><b id="r-corr" style="color:green">0</b></td></tr>
            <tr><td>üî¥ Wrong:</td><td><b id="r-wrong" style="color:red">0</b></td></tr>
            <tr><td>üìâ Negative Marks:</td><td><b id="r-neg" style="color:red">0</b></td></tr>
        </table>
        
        <button onclick="location.reload()" style="margin-top: 20px; padding: 10px 20px; background: #4f46e5; color: white; border: none; border-radius: 5px;">Go Home</button>
    </div>

    <script>
        // 1. CONFIGURATION
        const firebaseConfig = {
            apiKey: "AIzaSyBmsqEPUnWjjb2m4g1XgEcRrxlK_dOIDfE",
            authDomain: "revento-academy.firebaseapp.com",
            databaseURL: "https://revento-academy-default-rtdb.firebaseio.com",
            projectId: "revento-academy",
            storageBucket: "revento-academy.firebasestorage.app",
            messagingSenderId: "384071300366",
            appId: "1:384071300366:web:8a95f3ec8507bc2d3b535f",
            measurementId: "G-4L8YC6J095"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // 2. DATA (More Questions Added)
        const allQuestions = {
            'c10_math': [
                { q: "HCF of 96 and 404?", opt: ["4", "12", "8", "2"], ans: 0 },
                { q: "Degree of Quadratic Equation?", opt: ["0", "1", "2", "3"], ans: 2 }
            ],
            'c12_phy': [
                { q: "Unit of Charge?", opt: ["Ampere", "Coulomb", "Volt", "Watt"], ans: 1 },
                { q: "Ohm's Law?", opt: ["V=IR", "I=VR", "R=VI", "None"], ans: 0 }
            ],
          'airforce_x': [
                // --- PHYSICS (‡§≠‡•å‡§§‡§ø‡§ï ‡§µ‡§ø‡§ú‡•ç‡§û‡§æ‡§®) ---
                { q: "‡§¨‡§≤ (Force) ‡§ï‡•Ä ‡§µ‡§ø‡§Æ‡§æ ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•à?", opt: ["MLT-2", "MLT-1", "ML2T-2", "M0L0T0"], ans: 0 },
                { q: "‡§™‡•É‡§•‡•ç‡§µ‡•Ä ‡§ï‡•á ‡§ï‡•á‡§Ç‡§¶‡•ç‡§∞ ‡§™‡§∞ 'g' ‡§ï‡§æ ‡§Æ‡§æ‡§® ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•ã‡§§‡§æ ‡§π‡•à?", opt: ["9.8 m/s¬≤", "‡§∂‡•Ç‡§®‡•ç‡§Ø (Zero)", "‡§Ö‡§®‡§Ç‡§§ (Infinite)", "‡§á‡§®‡§Æ‡•á‡§Ç ‡§∏‡•á ‡§ï‡•ã‡§à ‡§®‡§π‡•Ä‡§Ç"], ans: 1 },
                { q: "‡§ß‡•ç‡§µ‡§®‡§ø (Sound) ‡§∏‡§¨‡§∏‡•á ‡§§‡•á‡§ú ‡§ï‡§ø‡§∏‡§Æ‡•á‡§Ç ‡§ö‡§≤‡§§‡•Ä ‡§π‡•à?", opt: ["‡§π‡§µ‡§æ ‡§Æ‡•á‡§Ç", "‡§™‡§æ‡§®‡•Ä ‡§Æ‡•á‡§Ç", "‡§∏‡•ç‡§ü‡•Ä‡§≤ (‡§†‡•ã‡§∏) ‡§Æ‡•á‡§Ç", "‡§®‡§ø‡§∞‡•ç‡§µ‡§æ‡§§ ‡§Æ‡•á‡§Ç"], ans: 2 },
                { q: "‡§™‡•ç‡§∞‡§ï‡§æ‡§∂ ‡§µ‡§∞‡•ç‡§∑ (Light Year) ‡§ï‡§ø‡§∏‡§ï‡§æ ‡§Æ‡§æ‡§§‡•ç‡§∞‡§ï ‡§π‡•à?", opt: ["‡§∏‡§Æ‡§Ø ‡§ï‡§æ", "‡§¶‡•Ç‡§∞‡•Ä ‡§ï‡§æ", "‡§™‡•ç‡§∞‡§ï‡§æ‡§∂ ‡§ï‡•Ä ‡§§‡•Ä‡§µ‡•ç‡§∞‡§§‡§æ ‡§ï‡§æ", "‡§¶‡•ç‡§∞‡§µ‡•ç‡§Ø‡§Æ‡§æ‡§® ‡§ï‡§æ"], ans: 1 },
                { q: "‡§µ‡§ø‡§¶‡•ç‡§Ø‡•Å‡§§ ‡§Ü‡§µ‡•á‡§∂ (Charge) ‡§ï‡§æ ‡§Æ‡§æ‡§§‡•ç‡§∞‡§ï ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•à?", opt: ["‡§è‡§Æ‡•ç‡§™‡•Ä‡§Ø‡§∞", "‡§ï‡•Ç‡§≤‡§æ‡§Æ‡•ç‡§¨", "‡§µ‡•ã‡§≤‡•ç‡§ü", "‡§µ‡§æ‡§ü"], ans: 1 },
                { q: "‡§™‡§æ‡§®‡•Ä ‡§ï‡§æ ‡§ò‡§®‡§§‡•ç‡§µ ‡§Ö‡§ß‡§ø‡§ï‡§§‡§Æ ‡§ï‡§ø‡§∏ ‡§§‡§æ‡§™‡§Æ‡§æ‡§® ‡§™‡§∞ ‡§π‡•ã‡§§‡§æ ‡§π‡•à?", opt: ["0¬∞C", "4¬∞C", "100¬∞C", "-4¬∞C"], ans: 1 },
                { q: "‡§∞‡•â‡§ï‡•á‡§ü ‡§ï‡§ø‡§∏ ‡§∏‡§ø‡§¶‡•ç‡§ß‡§æ‡§Ç‡§§ ‡§™‡§∞ ‡§ï‡§æ‡§∞‡•ç‡§Ø ‡§ï‡§∞‡§§‡§æ ‡§π‡•à?", opt: ["‡§ä‡§∞‡•ç‡§ú‡§æ ‡§∏‡§Ç‡§∞‡§ï‡•ç‡§∑‡§£", "‡§∏‡§Ç‡§µ‡•á‡§ó ‡§∏‡§Ç‡§∞‡§ï‡•ç‡§∑‡§£", "‡§¶‡•ç‡§∞‡§µ‡•ç‡§Ø‡§Æ‡§æ‡§® ‡§∏‡§Ç‡§∞‡§ï‡•ç‡§∑‡§£", "‡§á‡§®‡§Æ‡•á‡§Ç ‡§∏‡•á ‡§ï‡•ã‡§à ‡§®‡§π‡•Ä‡§Ç"], ans: 1 },

                // --- MATHS (‡§ó‡§£‡§ø‡§§) ---
                { q: "sin(90¬∞) ‡§ï‡§æ ‡§Æ‡§æ‡§® ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•à?", opt: ["0", "1", "1/2", "‡§Ö‡§®‡§Ç‡§§"], ans: 1 },
                { q: "‡§Ø‡§¶‡§ø A ‡§è‡§ï ‡§µ‡§∞‡•ç‡§ó ‡§Ü‡§µ‡•ç‡§Ø‡•Ç‡§π ‡§π‡•à, ‡§§‡•ã (A')' ‡§ï‡§ø‡§∏‡§ï‡•á ‡§¨‡§∞‡§æ‡§¨‡§∞ ‡§π‡•ã‡§ó‡§æ?", opt: ["A", "-A", "A'", "I"], ans: 0 },
                { q: "log(1) ‡§ï‡§æ ‡§Æ‡§æ‡§® ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•ã‡§§‡§æ ‡§π‡•à?", opt: ["0", "1", "10", "e"], ans: 0 },
                { q: "‡§µ‡•É‡§§‡•ç‡§§ (Circle) ‡§ï‡§æ ‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞‡§´‡§≤ ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•ã‡§§‡§æ ‡§π‡•à?", opt: ["2œÄr", "œÄr¬≤", "2œÄr¬≤", "œÄd"], ans: 1 },
                { q: "x¬≤ ‡§ï‡§æ ‡§Ö‡§µ‡§ï‡§≤‡§® (Derivative) ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•ã‡§ó‡§æ?", opt: ["x", "2x", "x¬≥", "2"], ans: 1 },
                { q: "tan(45¬∞) ‡§ï‡§æ ‡§Æ‡§æ‡§® ‡§¨‡§§‡§æ‡§ì?", opt: ["1/‚àö2", "‚àö3", "1", "0"], ans: 2 },
                
                // --- GK & REASONING (‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§ú‡•ç‡§û‡§æ‡§®) ---
                { q: "‡§≠‡§æ‡§∞‡§§ ‡§ï‡•á ‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§® CDS ‡§ï‡•å‡§® ‡§π‡•à‡§Ç?", opt: ["‡§ú‡§®‡§∞‡§≤ ‡§¨‡§ø‡§™‡§ø‡§® ‡§∞‡§æ‡§µ‡§§", "‡§ú‡§®‡§∞‡§≤ ‡§Ö‡§®‡§ø‡§≤ ‡§ö‡•å‡§π‡§æ‡§®", "‡§ú‡§®‡§∞‡§≤ ‡§è‡§Æ.‡§è‡§Æ. ‡§®‡§∞‡§µ‡§£‡•á", "‡§∞‡§æ‡§ú‡§®‡§æ‡§• ‡§∏‡§ø‡§Ç‡§π"], ans: 1 },
                { q: "‡§á‡§∏‡§∞‡•ã (ISRO) ‡§ï‡§æ ‡§Æ‡•Å‡§ñ‡•ç‡§Ø‡§æ‡§≤‡§Ø ‡§ï‡§π‡§æ‡§Å ‡§π‡•à?", opt: ["‡§¶‡§ø‡§≤‡•ç‡§≤‡•Ä", "‡§Æ‡•Å‡§Ç‡§¨‡§à", "‡§¨‡•à‡§Ç‡§ó‡§≤‡•ã‡§∞", "‡§ö‡•á‡§®‡•ç‡§®‡§à"], ans: 2 },
                { q: "‡§µ‡§æ‡§Ø‡•Å ‡§∏‡•á‡§®‡§æ ‡§¶‡§ø‡§µ‡§∏ (Air Force Day) ‡§ï‡§¨ ‡§Æ‡§®‡§æ‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à?", opt: ["8 ‡§Ö‡§ï‡•ç‡§ü‡•Ç‡§¨‡§∞", "15 ‡§ú‡§®‡§µ‡§∞‡•Ä", "4 ‡§¶‡§ø‡§∏‡§Ç‡§¨‡§∞", "26 ‡§ú‡§®‡§µ‡§∞‡•Ä"], ans: 0 },
                { q: "‡§ó‡§∞‡•Å‡§°‡§º (Garuda) ‡§∂‡§ï‡•ç‡§§‡§ø ‡§Ö‡§≠‡•ç‡§Ø‡§æ‡§∏ ‡§ï‡§ø‡§® ‡§¶‡•á‡§∂‡•ã‡§Ç ‡§ï‡•á ‡§¨‡•Ä‡§ö ‡§π‡•ã‡§§‡§æ ‡§π‡•à?", opt: ["‡§≠‡§æ‡§∞‡§§-‡§∞‡•Ç‡§∏", "‡§≠‡§æ‡§∞‡§§-‡§Ö‡§Æ‡•á‡§∞‡§ø‡§ï‡§æ", "‡§≠‡§æ‡§∞‡§§-‡§á‡§Ç‡§°‡•ã‡§®‡•á‡§∂‡§ø‡§Ø‡§æ", "‡§≠‡§æ‡§∞‡§§-‡§´‡•ç‡§∞‡§æ‡§Ç‡§∏"], ans: 2 },
                { q: "‡§Æ‡§ø‡§ú‡•ã‡§∞‡§Æ ‡§ï‡•Ä ‡§∞‡§æ‡§ú‡§ß‡§æ‡§®‡•Ä ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•à?", opt: ["‡§á‡§Æ‡•ç‡§´‡§æ‡§≤", "‡§∂‡§ø‡§≤‡•â‡§®‡•ç‡§ó", "‡§Ü‡§á‡§ú‡•ã‡§≤", "‡§ï‡•ã‡§π‡§ø‡§Æ‡§æ"], ans: 2 },
                { q: "‡§∞‡§æ‡§´‡•á‡§≤ (Rafale) ‡§µ‡§ø‡§Æ‡§æ‡§® ‡§ï‡§ø‡§∏ ‡§¶‡•á‡§∂ ‡§∏‡•á ‡§≤‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à?", opt: ["‡§Ö‡§Æ‡•á‡§∞‡§ø‡§ï‡§æ", "‡§∞‡•Ç‡§∏", "‡§´‡•ç‡§∞‡§æ‡§Ç‡§∏", "‡§á‡§ú‡§∞‡§æ‡§Ø‡§≤"], ans: 2 },
                { q: "‡§Ö‡§Ç‡§°‡§Æ‡§æ‡§® ‡§®‡§ø‡§ï‡•ã‡§¨‡§æ‡§∞ ‡§ï‡•Ä ‡§∞‡§æ‡§ú‡§ß‡§æ‡§®‡•Ä?", opt: ["‡§™‡•ã‡§∞‡•ç‡§ü ‡§¨‡•ç‡§≤‡•á‡§Ø‡§∞", "‡§ï‡§µ‡§æ‡§∞‡§§‡•ç‡§§‡•Ä", "‡§¶‡§Æ‡§£", "‡§≤‡•á‡§π"], ans: 0 }
            ]
        };

        let currentQ = 0, questions = [], responses = {}, subId = '', timerInt, user = null;

        // 3. AUTH
        auth.onAuthStateChanged(u => {
            if(u) {
                user = u;
                document.getElementById('login-screen').classList.add('hidden');
                document.getElementById('dashboard').classList.remove('hidden');
                document.getElementById('user-name').innerText = "Hi, " + u.displayName;
            }
        });
        function googleLogin() { auth.signInWithPopup(new firebase.auth.GoogleAuthProvider()); }
        function logout() { auth.signOut().then(() => location.reload()); }

        // 4. NAVIGATION
        function showSubjects(cls) {
            document.getElementById('dashboard').classList.add('hidden');
            document.getElementById('subject-screen').classList.remove('hidden');
            const list = document.getElementById('sub-list');
            if(cls === 'class10') list.innerHTML = `<div class="btn-card" onclick="startExam('c10_math')">Maths Test 1</div>`;
            else if(cls === 'class12') list.innerHTML = `<div class="btn-card" onclick="startExam('c12_phy')">Physics Mock</div>`;
        }

        async function startExam(sid) {
            subId = sid; questions = allQuestions[sid];
            if(!questions) { alert("Coming Soon!"); return; }
            
            // Check Attempt (Safe Mode)
            try {
                const doc = await db.collection('results').doc(user.uid + "_" + sid).get();
                if(doc.exists) { alert("Test Already Taken! Your Score: " + doc.data().score); return; }
            } catch(e) { console.log("DB check skipped"); }

            currentQ = 0; responses = {};
            for(let i=0; i<questions.length; i++) responses[i] = -1; // -1 means Not Attempted

            document.getElementById('dashboard').classList.add('hidden');
            document.getElementById('subject-screen').classList.add('hidden');
            document.getElementById('exam-interface').classList.remove('hidden');
            loadQ(0); genPalette(); startTimer();
        }

        // 5. EXAM ENGINE
        function loadQ(idx) {
            currentQ = idx;
            document.getElementById('q-text').innerText = `Q${idx+1}: ${questions[idx].q}`;
            let html = '';
            questions[idx].opt.forEach((o, i) => {
                let check = responses[idx] === i ? 'checked' : '';
                html += `<div style="margin:10px 0; padding:10px; border:1px solid #eee; border-radius:5px;">
                            <input type="radio" name="opt" value="${i}" ${check}> ${o}
                         </div>`;
            });
            document.getElementById('options-box').innerHTML = html;
        }

        function saveAndNext() {
            const opts = document.getElementsByName('opt');
            for(let o of opts) { if(o.checked) responses[currentQ] = parseInt(o.value); }
            updatePalette();
            if(currentQ < questions.length - 1) loadQ(currentQ + 1);
        }
        
        function clearRes() {
            responses[currentQ] = -1;
            loadQ(currentQ);
            updatePalette();
        }

        function genPalette() {
            let html = '';
            questions.forEach((_, i) => html += `<button id="p-${i}" class="p-btn" onclick="loadQ(${i})">${i+1}</button>`);
            document.getElementById('palette-box').innerHTML = html;
        }

        function updatePalette() {
            const btn = document.getElementById(`p-${currentQ}`);
            btn.className = (responses[currentQ] !== -1) ? 'p-btn ans' : 'p-btn';
        }

        function startTimer() {
            let t = 20 * 60;
            timerInt = setInterval(() => {
                let m = Math.floor(t/60), s = t%60;
                document.getElementById('timer').innerText = `${m}:${s < 10 ? '0'+s : s}`;
                t--; if(t<0) submitTest();
            }, 1000);
        }

        // --- NEGATIVE MARKING LOGIC ---
        function submitTest() {
            if(!confirm("Are you sure you want to Submit?")) return;
            clearInterval(timerInt);
            
            let correct = 0;
            let wrong = 0;
            let attempted = 0;

            questions.forEach((q, i) => {
                if(responses[i] !== -1) { // If attempted
                    attempted++;
                    if(responses[i] === q.ans) {
                        correct++;
                    } else {
                        wrong++;
                    }
                }
            });

            // Scoring: Correct = +1, Wrong = -0.25 (Only for Airforce)
            let score = 0;
            if(subId === 'airforce_x') {
                score = (correct * 1) - (wrong * 0.25);
            } else {
                score = correct; // Normal marking for 10th/12th
            }
            
            // Save Result
            db.collection('results').doc(user.uid + "_" + subId).set({
                name: user.displayName, score: score, subject: subId, date: new Date()
            }).then(() => showResult(score, correct, wrong, attempted));
        }

        function showResult(score, correct, wrong, attempted) {
            document.getElementById('exam-interface').classList.add('hidden');
            document.getElementById('result-screen').classList.remove('hidden');
            
            document.getElementById('final-score').innerText = score.toFixed(2); // Show 2 decimal places
            document.getElementById('r-total').innerText = questions.length;
            document.getElementById('r-att').innerText = attempted;
            document.getElementById('r-corr').innerText = correct;
            document.getElementById('r-wrong').innerText = wrong;
            document.getElementById('r-neg').innerText = (subId === 'airforce_x') ? (wrong * 0.25) : "0";
        }
    </script>
</body>
</html>
