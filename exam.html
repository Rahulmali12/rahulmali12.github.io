<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Revento Academy - Exam Portal</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    
    <style>
        /* Professional CSS Design */
        :root { --primary: #2563eb; --airforce-header: #3b82f6; }
        body { font-family: 'Segoe UI', sans-serif; background: #f3f4f6; margin: 0; }
        
        .hidden { display: none !important; }
        
        /* Dashboard Cards */
        .category-card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin: 10px; cursor: pointer; transition: 0.3s; }
        .category-card:hover { transform: translateY(-5px); border: 2px solid var(--primary); }

        /* Airforce Real Exam UI Design */
        #quiz-interface.airforce-mode { display: grid; grid-template-columns: 3fr 1fr; height: 100vh; }
        .question-area { padding: 20px; background: white; overflow-y: auto; }
        .question-palette { background: #e5e7eb; padding: 10px; display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px; align-content: start; }
        .palette-btn { width: 35px; height: 35px; border-radius: 50%; border: none; cursor: pointer; font-weight: bold; }
        
        /* Colors for Palette */
        .not-visited { background: white; border: 1px solid #ccc; }
        .answered { background: #22c55e; color: white; } /* Green */
        .not-answered { background: #ef4444; color: white; } /* Red */
        .review { background: #a855f7; color: white; } /* Purple */

        /* Leaderboard Table */
        table { width: 100%; border-collapse: collapse; background: white; }
        th, td { padding: 12px; border-bottom: 1px solid #ddd; text-align: left; }
        th { background: var(--primary); color: white; }
    </style>
</head>
<body>

    <div id="login-screen" style="text-align:center; padding: 50px;">
        <h1>Revento Academy Portal</h1>
        <button onclick="googleLogin()" style="padding: 10px 20px; background: #db4437; color: white; border: none; border-radius: 5px; font-size: 16px;">Login with Google</button>
    </div>

    <div id="dashboard" class="hidden">
        <header style="background: white; padding: 15px; display: flex; justify-content: space-between;">
            <h3 id="user-name">Welcome</h3>
            <button onclick="logout()">Logout</button>
        </header>

        <div style="padding: 20px; display: flex; flex-wrap: wrap; justify-content: center;">
            <div class="category-card" onclick="startTest('class10_math')">
                <h3>Class 10 - Maths</h3>
                <p>Chapter 1 to 5 Test</p>
            </div>
            <div class="category-card" onclick="startTest('class12_physics')">
                <h3>Class 12 - Physics</h3>
                <p>Full Syllabus Mock</p>
            </div>
            <div class="category-card" onclick="startTest('airforce_x', true)">
                <h3>‚öì Airforce X Group</h3>
                <p>Full Mock Test (Real UI)</p>
            </div>
            <div class="category-card" onclick="showPDFs()">
                <h3>üìö PDF Section</h3>
                <p>Notes & Formulas</p>
            </div>
        </div>
    </div>

    <div id="quiz-interface" class="hidden">
        <div class="question-area">
            <div style="display: flex; justify-content: space-between; border-bottom: 2px solid #ddd; padding-bottom: 10px;">
                <h3 id="timer">Time Left: 20:00</h3>
                <button onclick="submitTest()" style="background: green; color: white; padding: 5px 15px; border: none;">SUBMIT TEST</button>
            </div>
            <h2 id="q-text">Question goes here...</h2>
            <div id="options-container">
                </div>
            <div style="margin-top: 20px;">
                <button onclick="prevQ()">Previous</button>
                <button onclick="nextQ()" style="background: var(--primary); color: white;">Save & Next</button>
            </div>
        </div>
        
        <div class="question-palette" id="palette-box">
            </div>
    </div>

    <div id="result-screen" class="hidden" style="padding: 20px;">
        <h2 align="center">üèÜ Live Leaderboard</h2>
        <h3 align="center">Your Score: <span id="my-score">0</span></h3>
        <table id="rank-table">
            <thead>
                <tr>
                    <th>Rank</th>
                    <th>Name</th>
                    <th>Score</th>
                </tr>
            </thead>
            <tbody id="leaderboard-body">
                </tbody>
        </table>
        <button onclick="location.reload()" style="margin-top: 20px;">Go Back</button>
    </div>

    <script>
      
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyBmsqEPUnWjjb2m4g1XgEcRrxlK_dOIDfE",
  authDomain: "revento-academy.firebaseapp.com",
  databaseURL: "https://revento-academy-default-rtdb.firebaseio.com",
  projectId: "revento-academy",
  storageBucket: "revento-academy.firebasestorage.app",
  messagingSenderId: "384071300366",
  appId: "1:384071300366:web:8a95f3ec8507bc2d3b535f",
  measurementId: "G-4L8YC6J095"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);

        let currentUser = null;
        let currentQuizId = '';
        let questions = []; // Load from JSON or Object
        let currentQIndex = 0;
        let userAnswers = {}; // Store answers {0: 'A', 1: 'B'}
        let timerInterval;

        // --- 2. AUTHENTICATION ---
        function googleLogin() {
            const provider = new firebase.auth.GoogleAuthProvider();
            auth.signInWithPopup(provider).then((result) => {
                currentUser = result.user;
                checkUser();
            });
        }

        function checkUser() {
            auth.onAuthStateChanged(user => {
                if (user) {
                    currentUser = user;
                    document.getElementById('login-screen').classList.add('hidden');
                    document.getElementById('dashboard').classList.remove('hidden');
                    document.getElementById('user-name').innerText = "Hi, " + user.displayName;
                }
            });
        }

        function logout() { auth.signOut().then(() => location.reload()); }

        // --- 3. ONE ATTEMPT LOGIC & START TEST ---
        async function startTest(quizId, isAirforce = false) {
            currentQuizId = quizId;
            
            // CHECK IF ALREADY ATTEMPTED
            const docRef = db.collection('results').doc(currentUser.uid + "_" + quizId);
            const doc = await docRef.get();

            if (doc.exists) {
                alert("üö´ You have already attempted this test! Showing your result.");
                showLeaderboard(quizId);
                return;
            }

            // LOAD QUESTIONS (Demo Data)
            // Real project me tum alag JSON file se load karoge
            questions = [
                { q: "Unit of Force?", opt: ["Newton", "Joule", "Watt", "Pascal"], ans: 0 },
                { q: "Capital of India?", opt: ["Mumbai", "Delhi", "Jaipur", "Goa"], ans: 1 },
                // Add more...
            ];

            // UI SETUP
            document.getElementById('dashboard').classList.add('hidden');
            document.getElementById('quiz-interface').classList.remove('hidden');
            
            if(isAirforce) {
                document.getElementById('quiz-interface').classList.add('airforce-mode');
                generatePalette();
            }

            loadQuestion(0);
            startTimer(20); // 20 Minutes
        }

        // --- 4. QUIZ ENGINE ---
        function loadQuestion(index) {
            currentQIndex = index;
            const q = questions[index];
            document.getElementById('q-text').innerText = `Q${index + 1}: ${q.q}`;
            
            let html = '';
            q.opt.forEach((opt, i) => {
                let checked = userAnswers[index] === i ? 'checked' : '';
                html += `<div style="padding: 10px; border:1px solid #ddd; margin: 5px;">
                            <input type="radio" name="opt" value="${i}" ${checked} onchange="saveAnswer(${index}, ${i})"> ${opt}
                         </div>`;
            });
            document.getElementById('options-container').innerHTML = html;
        }

        function saveAnswer(qIndex, ansIndex) {
            userAnswers[qIndex] = ansIndex;
            updatePalette(qIndex, 'answered');
        }

        function nextQ() {
            if (currentQIndex < questions.length - 1) loadQuestion(currentQIndex + 1);
        }
        
        function prevQ() {
            if (currentQIndex > 0) loadQuestion(currentQIndex - 1);
        }

        // --- 5. SUBMIT & RANKING ---
        function submitTest() {
            if(!confirm("Are you sure you want to submit?")) return;
            clearInterval(timerInterval);

            // Calculate Score
            let score = 0;
            questions.forEach((q, i) => {
                if (userAnswers[i] === q.ans) score += 1; // Negative marking logic can be added here
            });

            // SAVE TO FIRESTORE
            db.collection('results').doc(currentUser.uid + "_" + currentQuizId).set({
                name: currentUser.displayName,
                userId: currentUser.uid,
                quizId: currentQuizId,
                score: score,
                timestamp: firebase.firestore.FieldValue.serverTimestamp() // For Tie-breaking
            }).then(() => {
                document.getElementById('my-score').innerText = score;
                showLeaderboard(currentQuizId);
            });
        }

        function showLeaderboard(quizId) {
            document.getElementById('quiz-interface').classList.add('hidden');
            document.getElementById('dashboard').classList.add('hidden');
            document.getElementById('result-screen').classList.remove('hidden');

            // LIVE LEADERBOARD QUERY
            db.collection('results')
              .where('quizId', '==', quizId)
              .orderBy('score', 'desc')
              .orderBy('timestamp', 'asc') // First come first serve rank logic
              .limit(10)
              .onSnapshot(snapshot => {
                  let html = '';
                  let rank = 1;
                  snapshot.forEach(doc => {
                      let data = doc.data();
                      let isMe = data.userId === currentUser.uid ? 'style="background: #e0f2fe; font-weight:bold;"' : '';
                      html += `<tr ${isMe}>
                                  <td>#${rank++}</td>
                                  <td>${data.name}</td>
                                  <td>${data.score}</td>
                               </tr>`;
                  });
                  document.getElementById('leaderboard-body').innerHTML = html;
              });
        }

        // --- EXTRAS ---
        function generatePalette() {
            let html = '';
            for(let i=0; i<questions.length; i++) {
                html += `<button id="pal-${i}" class="palette-btn not-visited" onclick="loadQuestion(${i})">${i+1}</button>`;
            }
            document.getElementById('palette-box').innerHTML = html;
        }
        
        function updatePalette(index, status) {
            let btn = document.getElementById(`pal-${index}`);
            if(btn) {
                btn.className = `palette-btn ${status}`;
            }
        }

        function startTimer(minutes) {
            let time = minutes * 60;
            timerInterval = setInterval(() => {
                let m = Math.floor(time / 60);
                let s = time % 60;
                document.getElementById('timer').innerText = `Time Left: ${m}:${s < 10 ? '0'+s : s}`;
                time--;
                if(time < 0) submitTest();
            }, 1000);
        }
        
        function showPDFs() {
            // PDF Page logic or Links
            alert("PDF Section: Yahan Firebase Storage ke links add kar dena!");
        }
    </script>
</body>
</html>
