<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Revento Academy - Online Exam Portal</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    
    <style>
        /* --- PROFESSIONAL STYLING --- */
        :root { --primary: #2563eb; --header: #1e3a8a; --bg: #f3f4f6; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--bg); margin: 0; user-select: none; }
        
        .hidden { display: none !important; }
        
        /* Login & Dashboard */
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); text-align: center; margin-bottom: 20px; }
        
        /* Grid for Categories */
        .grid-box { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 20px; }
        .btn-select { background: white; border: 2px solid var(--primary); color: var(--primary); padding: 20px; border-radius: 10px; cursor: pointer; font-size: 18px; font-weight: bold; transition: 0.3s; }
        .btn-select:hover { background: var(--primary); color: white; transform: translateY(-3px); }

        /* --- EXAM INTERFACE (CBT DESIGN) --- */
        #quiz-interface { display: flex; height: 100vh; flex-direction: column; }
        
        /* Top Bar */
        .exam-header { background: var(--header); color: white; padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; }
        
        /* Main Layout */
        .exam-body { display: flex; flex: 1; overflow: hidden; }
        .question-area { flex: 3; padding: 30px; overflow-y: auto; background: white; }
        .sidebar { flex: 1; background: #e5e7eb; border-left: 2px solid #ccc; display: flex; flex-direction: column; }
        
        /* Question Palette (Numbers) */
        .palette-grid { padding: 15px; display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; overflow-y: auto; flex: 1; }
        .p-btn { width: 40px; height: 40px; border-radius: 50%; border: 1px solid #999; cursor: pointer; font-weight: bold; font-size: 14px; background: white; }
        
        /* CBT Color Codes */
        .status-not-visited { background: white; }
        .status-not-answered { background: #ef4444; color: white; border: none; } /* Red */
        .status-answered { background: #22c55e; color: white; border: none; } /* Green */
        .status-review { background: #a855f7; color: white; border: none; } /* Purple */

        /* Question Options */
        .option-box { display: block; padding: 12px; border: 1px solid #ddd; margin: 10px 0; border-radius: 5px; cursor: pointer; transition: 0.2s; }
        .option-box:hover { background: #f0f9ff; }
        input[type="radio"] { margin-right: 10px; }

        /* Footer Controls */
        .exam-footer { padding: 15px; background: white; border-top: 1px solid #ccc; display: flex; justify-content: space-between; }
        .btn-nav { padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .btn-save { background: #22c55e; color: white; }
        .btn-review { background: #a855f7; color: white; }
        .btn-clear { background: #ef4444; color: white; }

        /* Mobile Adjustments */
        @media (max-width: 768px) {
            .exam-body { flex-direction: column; }
            .sidebar { height: 150px; flex: none; order: -1; }
        }
        
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 12px; border: 1px solid #ddd; text-align: left; }
        th { background: var(--primary); color: white; }
    </style>
</head>
<body>

    <div id="login-screen" class="container" style="text-align: center; margin-top: 100px;">
        <h1 style="color: var(--header);">Revento Academy Portal</h1>
        <p>Professional Exam System for 10th, 12th & Airforce</p>
        <button onclick="googleLogin()" style="padding: 15px 30px; background: #db4437; color: white; border: none; border-radius: 5px; font-size: 18px; cursor: pointer;">
            Login with Google
        </button>
    </div>

    <div id="dashboard" class="container hidden">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <h2 id="user-name">Welcome</h2>
            <button onclick="logout()" style="background:red; color:white; border:none; padding:5px 10px; cursor:pointer;">Logout</button>
        </div>
        <hr>
        <h3>üéØ Select Your Category</h3>
        <div class="grid-box">
            <button class="btn-select" onclick="showSubjects('class10')">Class 10th</button>
            <button class="btn-select" onclick="showSubjects('class12')">Class 12th</button>
            <button class="btn-select" onclick="showSubjects('airforce')">‚úàÔ∏è Airforce X Group</button>
            <button class="btn-select" onclick="openPDF()">üìö PDF Section</button>
        </div>
    </div>

    <div id="subject-screen" class="container hidden">
        <button onclick="goBackToDash()" style="margin-bottom:20px;">‚¨Ö Back</button>
        <h3 id="selected-class-title">Select Subject</h3>
        <div class="grid-box" id="subject-buttons">
            </div>
    </div>

    <div id="exam-interface" class="hidden">
        <div class="exam-header">
            <span id="exam-title">Airforce Mock Test</span>
            <span id="timer" style="font-size: 20px; font-weight: bold; background: black; padding: 5px 10px; border-radius: 5px;">20:00</span>
            <button onclick="submitTest()" style="background: #ef4444; color: white; border: none; padding: 8px 15px; border-radius: 3px; cursor: pointer; font-weight: bold;">SUBMIT</button>
        </div>

        <div class="exam-body">
            <div class="question-area">
                <h3 id="q-no">Question 1:</h3>
                <p id="q-text" style="font-size: 18px; margin-bottom: 20px;">Question text...</p>
                <div id="options-box">
                    </div>
            </div>

            <div class="sidebar">
                <div style="padding: 10px; background: #ddd; font-weight: bold; text-align: center;">Question Palette</div>
                <div class="palette-grid" id="palette-box">
                    </div>
                <div style="padding: 10px; font-size: 12px; display: flex; flex-wrap: wrap; gap: 5px;">
                    <span style="color:green">‚óè Answered</span>
                    <span style="color:red">‚óè Not Answered</span>
                    <span style="color:purple">‚óè Review</span>
                </div>
            </div>
        </div>

        <div class="exam-footer">
            <button class="btn-nav btn-review" onclick="markReview()">Mark for Review</button>
            <div>
                <button class="btn-nav" onclick="prevQ()">Previous</button>
                <button class="btn-nav btn-clear" onclick="clearResponse()">Clear</button>
                <button class="btn-nav btn-save" onclick="saveAndNext()">Save & Next</button>
            </div>
        </div>
    </div>

    <div id="result-screen" class="container hidden">
        <h2 style="text-align: center; color: var(--primary);">üèÜ Exam Result & Leaderboard</h2>
        <div class="card">
            <h3>Your Score: <span id="my-score" style="font-size: 30px; color: green;">0</span></h3>
            <p>Subject: <span id="result-subject"></span></p>
        </div>
        
        <h3>Live Rankings (Top 10)</h3>
        <table id="rank-table">
            <thead>
                <tr>
                    <th>Rank</th>
                    <th>Student Name</th>
                    <th>Score</th>
                </tr>
            </thead>
            <tbody id="leaderboard-body">
                </tbody>
        </table>
        <button onclick="location.reload()" style="margin-top: 20px; padding: 10px 20px; background: var(--header); color: white; border: none;">Go Home</button>
    </div>

    <script>
       // Import the functions you need from the SDKs you need
import { initializeApp } from "firebase/app";
import { getAnalytics } from "firebase/analytics";
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyCxBOkPvD6vPle89zTnC8L-HzSuScCv4N0",
  authDomain: "lokesh-cfd68.firebaseapp.com",
  databaseURL: "https://lokesh-cfd68-default-rtdb.firebaseio.com",
  projectId: "lokesh-cfd68",
  storageBucket: "lokesh-cfd68.firebasestorage.app",
  messagingSenderId: "198098145062",
  appId: "1:198098145062:web:185f994565bfa3024dfbe7",
  measurementId: "G-X8TGPG98JN"
};

// Initialize Firebase


        // --- 2. GLOBAL VARIABLES ---
        let currentUser = null;
        let currentSubjectId = '';
        let questions = []; 
        let currentQIndex = 0;
        let userResponses = {}; // { 0: {ans: 1, status: 'answered'} }
        let timerInterval;

        // --- 3. DATABASE (Questions Here) ---
        // Yahaan tum 1000 sawal bhi daal sakte ho
        const quizDatabase = {
            // CLASS 10
            'c10_math': [
                { q: "HCF of 96 and 404 is?", opt: ["4", "12", "3", "10"], ans: 0 },
                { q: "Sum of zeros of quadratic polynomial?", opt: ["-b/a", "c/a", "a/b", "None"], ans: 0 }
            ],
            'c10_sci': [
                { q: "Powerhouse of the cell?", opt: ["Nucleus", "Mitochondria", "Ribosome", "Golgi"], ans: 1 },
                { q: "Formula of Rust?", opt: ["FeO", "Fe2O3", "Fe3O4", "None"], ans: 1 }
            ],
            'c10_eng': [ { q: "Past tense of Go?", opt: ["Gone", "Went", "Going", "Goes"], ans: 1 } ],
            'c10_sst': [ { q: "When did Jallianwala Bagh massacre happen?", opt: ["1919", "1920", "1921", "1947"], ans: 0 } ],

            // CLASS 12
            'c12_phy': [
                { q: "SI unit of Electric Field?", opt: ["N/C", "V/m", "Both", "None"], ans: 2 },
                { q: "Speed of light in vacuum?", opt: ["3x10^8", "3x10^6", "3x10^5", "None"], ans: 0 }
            ],
            'c12_math': [ { q: "Integration of 1/x?", opt: ["log x", "e^x", "x^2", "None"], ans: 0 } ],

            // AIRFORCE (REAL MOCK)
            'airforce_x': [
                { q: "Dimension of Plank's Constant?", opt: ["ML2T-1", "MLT-1", "ML2T-2", "M0L0T0"], ans: 0 },
                { q: "If sinA = 3/5, find cosA?", opt: ["4/5", "3/4", "5/4", "None"], ans: 0 },
                { q: "Capital of Australia?", opt: ["Sydney", "Canberra", "Melbourne", "Perth"], ans: 1 },
                { q: "Who is the supreme commander of Indian Armed Forces?", opt: ["PM", "President", "CDS", "Defense Minister"], ans: 1 },
                { q: "Value of g at center of earth?", opt: ["9.8", "0", "Infinite", "None"], ans: 1 }
            ]
        };

        // --- 4. AUTH & NAVIGATION ---
        function googleLogin() {
            const provider = new firebase.auth.GoogleAuthProvider();
            auth.signInWithPopup(provider).then((res) => {
                currentUser = res.user;
                checkUser();
            });
        }

        function checkUser() {
            auth.onAuthStateChanged(user => {
                if (user) {
                    currentUser = user;
                    document.getElementById('login-screen').classList.add('hidden');
                    document.getElementById('dashboard').classList.remove('hidden');
                    document.getElementById('user-name').innerText = "Hi, " + user.displayName;
                }
            });
        }

        function logout() { auth.signOut().then(() => location.reload()); }

        function showSubjects(category) {
            document.getElementById('dashboard').classList.add('hidden');
            document.getElementById('subject-screen').classList.remove('hidden');
            const box = document.getElementById('subject-buttons');
            box.innerHTML = '';
            let title = '';

            if (category === 'class10') {
                title = "Class 10 Subjects";
                box.innerHTML = `
                    <button class="btn-select" onclick="startExam('c10_math')">Mathematics</button>
                    <button class="btn-select" onclick="startExam('c10_sci')">Science</button>
                    <button class="btn-select" onclick="startExam('c10_eng')">English</button>
                    <button class="btn-select" onclick="startExam('c10_sst')">Social Science</button>
                `;
            } else if (category === 'class12') {
                title = "Class 12 Subjects";
                box.innerHTML = `
                    <button class="btn-select" onclick="startExam('c12_phy')">Physics</button>
                    <button class="btn-select" onclick="startExam('c12_math')">Mathematics</button>
                `;
            } else if (category === 'airforce') {
                startExam('airforce_x'); // Direct Start for Airforce
                return;
            }
            document.getElementById('selected-class-title').innerText = title;
        }

        function goBackToDash() {
            document.getElementById('subject-screen').classList.add('hidden');
            document.getElementById('dashboard').classList.remove('hidden');
        }

        // --- 5. EXAM ENGINE (CORE LOGIC) ---
        async function startExam(subId) {
            currentSubjectId = subId;

            // One Attempt Check
            const docRef = db.collection('results').doc(currentUser.uid + "_" + subId);
            const doc = await docRef.get();
            if (doc.exists) {
                alert("üö´ You have already attempted this test!");
                showResult(subId);
                return;
            }

            questions = quizDatabase[subId];
            if (!questions) { alert("Questions not added yet!"); return; }

            // Initialize Responses
            userResponses = {};
            for(let i=0; i<questions.length; i++) {
                userResponses[i] = { ans: null, status: 'not-visited' };
            }

            // UI Switch
            document.getElementById('dashboard').classList.add('hidden');
            document.getElementById('subject-screen').classList.add('hidden');
            document.getElementById('exam-interface').classList.remove('hidden');

            generatePalette();
            loadQuestion(0);
            startTimer(20); // 20 Mins
        }

        function loadQuestion(index) {
            currentQIndex = index;
            document.getElementById('q-no').innerText = `Question ${index + 1}:`;
            document.getElementById('q-text').innerText = questions[index].q;

            // Render Options
            let html = '';
            questions[index].opt.forEach((opt, i) => {
                let checked = userResponses[index].ans === i ? 'checked' : '';
                html += `<label class="option-box">
                            <input type="radio" name="opt" value="${i}" ${checked}> ${opt}
                         </label>`;
            });
            document.getElementById('options-box').innerHTML = html;

            // Mark as visited if not answered
            if (userResponses[index].status === 'not-visited') {
                userResponses[index].status = 'not-answered';
                updatePaletteBtn(index);
            }
        }

        function saveAndNext() {
            // Get selected option
            const options = document.getElementsByName('opt');
            let selected = null;
            for (let op of options) { if (op.checked) selected = parseInt(op.value); }

            if (selected !== null) {
                userResponses[currentQIndex].ans = selected;
                userResponses[currentQIndex].status = 'answered';
            } else {
                userResponses[currentQIndex].status = 'not-answered';
            }
            
            updatePaletteBtn(currentQIndex);
            
            if (currentQIndex < questions.length - 1) {
                loadQuestion(currentQIndex + 1);
            }
        }

        function markReview() {
            userResponses[currentQIndex].status = 'review';
            updatePaletteBtn(currentQIndex);
            if (currentQIndex < questions.length - 1) loadQuestion(currentQIndex + 1);
        }
        
        function clearResponse() {
            userResponses[currentQIndex].ans = null;
            userResponses[currentQIndex].status = 'not-answered';
            loadQuestion(currentQIndex); // Reload to clear radio
            updatePaletteBtn(currentQIndex);
        }

        function prevQ() {
            if (currentQIndex > 0) loadQuestion(currentQIndex - 1);
        }

        // --- 6. PALETTE & CBT FEATURES ---
        function generatePalette() {
            let html = '';
            questions.forEach((_, i) => {
                html += `<button id="pal-${i}" class="p-btn status-not-visited" onclick="loadQuestion(${i})">${i+1}</button>`;
            });
            document.getElementById('palette-box').innerHTML = html;
        }

        function updatePaletteBtn(index) {
            const btn = document.getElementById(`pal-${index}`);
            const status = userResponses[index].status;
            
            // Remove old classes
            btn.classList.remove('status-not-visited', 'status-answered', 'status-not-answered', 'status-review');
            // Add new class
            btn.classList.add('status-' + status);
        }

        // --- 7. SUBMISSION & RESULT ---
        function startTimer(mins) {
            let time = mins * 60;
            timerInterval = setInterval(() => {
                let m = Math.floor(time / 60);
                let s = time % 60;
                document.getElementById('timer').innerText = `${m}:${s < 10 ? '0'+s : s}`;
                time--;
                if (time < 0) submitTest();
            }, 1000);
        }

        function submitTest() {
            if (!confirm("Confirm Final Submit?")) return;
            clearInterval(timerInterval);

            let score = 0;
            questions.forEach((q, i) => {
                if (userResponses[i].ans === q.ans) score++;
            });

            // Save to Firebase
            db.collection('results').doc(currentUser.uid + "_" + currentSubjectId).set({
                name: currentUser.displayName,
                score: score,
                subject: currentSubjectId,
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            }).then(() => {
                showResult(currentSubjectId);
            });
        }

        function showResult(subId) {
            document.getElementById('exam-interface').classList.add('hidden');
            document.getElementById('result-screen').classList.remove('hidden');
            document.getElementById('result-subject').innerText = subId.toUpperCase();

            // Fetch Live Leaderboard
             db.collection('results')
              .where('subject', '==', subId)
              .orderBy('score', 'desc')
              .limit(10)
              .onSnapshot(snap => {
                  let html = '';
                  let rank = 1;
                  snap.forEach(doc => {
                      let d = doc.data();
                      if(doc.id === currentUser.uid + "_" + subId) document.getElementById('my-score').innerText = d.score;
                      
                      html += `<tr>
                          <td>#${rank++}</td>
                          <td>${d.name}</td>
                          <td>${d.score}</td>
                      </tr>`;
                  });
                  document.getElementById('leaderboard-body').innerHTML = html;
              });
        }
        
        function openPDF() {
            alert("PDF Page under construction! Link Firebase Storage here.");
        }
    </script>
</body>
</html>
