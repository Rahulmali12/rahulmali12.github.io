<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Revento Academy - Online Exam Portal</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    
    <style>
        /* --- STYLING --- */
        :root { --primary: #2563eb; --header: #1e3a8a; --bg: #f3f4f6; }
        body { font-family: sans-serif; background: var(--bg); margin: 0; user-select: none; }
        .hidden { display: none !important; }
        
        .container { max-width: 800px; margin: 0 auto; padding: 20px; text-align: center; }
        .btn-select { display: block; width: 100%; margin: 10px 0; padding: 15px; background: white; border: 2px solid var(--primary); color: var(--primary); font-size: 18px; cursor: pointer; border-radius: 8px; }
        .btn-select:hover { background: var(--primary); color: white; }

        /* Exam Interface */
        #exam-interface { display: flex; flex-direction: column; height: 100vh; }
        .header { background: var(--header); color: white; padding: 10px; display: flex; justify-content: space-between; }
        .content { flex: 1; padding: 20px; overflow-y: auto; background: white; }
        .sidebar { height: 150px; background: #e5e7eb; padding: 10px; overflow-y: auto; }
        .palette-btn { width: 35px; height: 35px; border-radius: 50%; margin: 3px; border: 1px solid gray; cursor: pointer; }
        
        /* Colors */
        .answered { background: green; color: white; }
        .not-answered { background: red; color: white; }
        .review { background: purple; color: white; }
        .not-visited { background: white; }
    </style>
</head>
<body>

    <div id="login-screen" class="container" style="margin-top: 100px;">
        <h1 style="color: var(--header);">Revento Academy</h1>
        <button onclick="googleLogin()" style="padding: 15px 30px; background: #db4437; color: white; border: none; font-size: 18px; cursor: pointer; border-radius: 5px;">
            Login with Google
        </button>
    </div>

    <div id="dashboard" class="container hidden">
        <h2 id="user-name">Welcome</h2>
        <button class="btn-select" onclick="showSubjects('class10')">Class 10th</button>
        <button class="btn-select" onclick="showSubjects('class12')">Class 12th</button>
        <button class="btn-select" onclick="startExam('airforce_x')">✈️ Airforce X Group (Real Mock)</button>
    </div>

    <div id="subject-screen" class="container hidden">
        <h3>Select Subject</h3>
        <div id="subject-buttons"></div>
        <button onclick="location.reload()" style="margin-top:20px;">Back</button>
    </div>

    <div id="exam-interface" class="hidden">
        <div class="header">
            <span id="timer">20:00</span>
            <button onclick="submitTest()" style="background:red; color:white; border:none; padding:5px;">SUBMIT</button>
        </div>
        <div class="content">
            <h3 id="q-text">Question...</h3>
            <div id="options-box"></div>
            <br>
            <button onclick="prevQ()">Previous</button>
            <button onclick="saveAndNext()" style="background:var(--primary); color:white; padding:5px 15px; border:none;">Save & Next</button>
        </div>
        <div class="sidebar" id="palette-box"></div>
    </div>

    <div id="result-screen" class="container hidden">
        <h1>Your Score: <span id="my-score">0</span></h1>
        <h3>Leaderboard</h3>
        <ul id="leaderboard-list" style="list-style: none; padding: 0;"></ul>
        <button onclick="location.reload()" style="margin-top:20px; padding:10px;">Go Home</button>
    </div>

    <script>
        // --- 1. CONFIGURATION (Tumhari Keys) ---
        const firebaseConfig = {
            apiKey: "AIzaSyCxBOkPVD6vPle89zTnC8L-HzSuSxcV4N0",
            authDomain: "lokesh-cfd68.firebaseapp.com",
            databaseURL: "https://lokesh-cfd68-default-rtdb.firebaseio.com",
            projectId: "lokesh-cfd68",
            storageBucket: "lokesh-cfd68.firebasestorage.app",
            messagingSenderId: "198098145062",
            appId: "1:198098145062:web:185f994565bfa3024dfbe7",
            measurementId: "G-X8TGPG98JN"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // --- 2. VARIABLES ---
        let currentUser = null;
        let questions = [];
        let currentQIndex = 0;
        let userResponses = {};
        let currentSubId = '';
        let timerInterval;

        // --- 3. QUESTIONS DATA ---
        const allQuestions = {
            'c10_math': [
                { q: "10th Math: Real Numbers में π क्या है?", opt: ["Rational", "Irrational", "Integer", "None"], ans: 1 },
                { q: "Quadratic Equation की डिग्री क्या होती है?", opt: ["1", "2", "3", "0"], ans: 1 }
            ],
            'c12_phy': [
                { q: "12th Phy: Unit of Charge?", opt: ["Ampere", "Coulomb", "Volt", "Watt"], ans: 1 },
                { q: "Ohm's Law formula?", opt: ["V=IR", "I=VR", "R=VI", "None"], ans: 0 }
            ],
            'airforce_x': [
                { q: "AF Physics: Dimension of Force?", opt: ["MLT-2", "MLT-1", "ML2T-2", "M0L0T0"], ans: 0 },
                { q: "AF Math: Integration of sin(x)?", opt: ["cos(x)", "-cos(x)", "sin(x)", "tan(x)"], ans: 1 },
                { q: "Capital of India?", opt: ["Delhi", "Mumbai", "Kolkata", "Chennai"], ans: 0 }
            ]
        };

        // --- 4. FUNCTIONS ---
        function googleLogin() {
            const provider = new firebase.auth.GoogleAuthProvider();
            auth.signInWithPopup(provider)
                .then((res) => {
                    currentUser = res.user;
                    document.getElementById('login-screen').classList.add('hidden');
                    document.getElementById('dashboard').classList.remove('hidden');
                    document.getElementById('user-name').innerText = "Hi, " + currentUser.displayName;
                })
                .catch((error) => alert("Login Failed: " + error.message));
        }

        function showSubjects(cls) {
            document.getElementById('dashboard').classList.add('hidden');
            document.getElementById('subject-screen').classList.remove('hidden');
            const box = document.getElementById('subject-buttons');
            
            if(cls === 'class10') {
                box.innerHTML = `<button class="btn-select" onclick="startExam('c10_math')">Maths</button>`;
            } else if(cls === 'class12') {
                box.innerHTML = `<button class="btn-select" onclick="startExam('c12_phy')">Physics</button>`;
            }
        }

        async function startExam(subId) {
            currentSubId = subId;
            // Check One Attempt
            const doc = await db.collection('results').doc(currentUser.uid + "_" + subId).get();
            if(doc.exists) {
                alert("You have already taken this test!");
                showResult(subId);
                return;
            }

            questions = allQuestions[subId];
            if(!questions) { alert("Questions not ready!"); return; }

            // Reset
            userResponses = {};
            for(let i=0; i<questions.length; i++) userResponses[i] = { ans: null, status: 'not-visited' };

            document.getElementById('dashboard').classList.add('hidden');
            document.getElementById('subject-screen').classList.add('hidden');
            document.getElementById('exam-interface').classList.remove('hidden');

            generatePalette();
            loadQuestion(0);
            startTimer();
        }

        function loadQuestion(idx) {
            currentQIndex = idx;
            document.getElementById('q-text').innerText = `Q${idx+1}: ${questions[idx].q}`;
            let html = '';
            questions[idx].opt.forEach((opt, i) => {
                let checked = userResponses[idx].ans === i ? 'checked' : '';
                html += `<div style="padding:5px;"><input type="radio" name="opt" value="${i}" ${checked}> ${opt}</div>`;
            });
            document.getElementById('options-box').innerHTML = html;
        }

        function saveAndNext() {
            const opts = document.getElementsByName('opt');
            for(let o of opts) {
                if(o.checked) {
                    userResponses[currentQIndex].ans = parseInt(o.value);
                    userResponses[currentQIndex].status = 'answered';
                }
            }
            updatePalette();
            if(currentQIndex < questions.length - 1) loadQuestion(currentQIndex + 1);
        }

        function prevQ() { if(currentQIndex > 0) loadQuestion(currentQIndex - 1); }

        function generatePalette() {
            let html = '';
            questions.forEach((_, i) => html += `<button id="pal-${i}" class="palette-btn not-visited" onclick="loadQuestion(${i})">${i+1}</button>`);
            document.getElementById('palette-box').innerHTML = html;
        }

        function updatePalette() {
            const btn = document.getElementById(`pal-${currentQIndex}`);
            if(userResponses[currentQIndex].status === 'answered') {
                btn.className = 'palette-btn answered';
            } else {
                btn.className = 'palette-btn not-answered';
            }
        }

        function startTimer() {
            let t = 20 * 60;
            timerInterval = setInterval(() => {
                let m = Math.floor(t/60);
                let s = t%60;
                document.getElementById('timer').innerText = `${m}:${s}`;
                t--;
                if(t<0) submitTest();
            }, 1000);
        }

        function submitTest() {
            clearInterval(timerInterval);
            let score = 0;
            questions.forEach((q, i) => {
                if(userResponses[i].ans === q.ans) score++;
            });

            db.collection('results').doc(currentUser.uid + "_" + currentSubId).set({
                name: currentUser.displayName,
                score: score,
                subject: currentSubId
            }).then(() => showResult(currentSubId));
        }

        function showResult(subId) {
            document.getElementById('exam-interface').classList.add('hidden');
            document.getElementById('result-screen').classList.remove('hidden');
            
            db.collection('results').where('subject', '==', subId).orderBy('score', 'desc').limit(5).get().then(snap => {
                let html = '';
                snap.forEach(doc => {
                    let d = doc.data();
                    if(doc.id === currentUser.uid + "_" + subId) document.getElementById('my-score').innerText = d.score;
                    html += `<li>${d.name}: ${d.score}</li>`;
                });
                document.getElementById('leaderboard-list').innerHTML = html;
            });
        }
    </script>
</body>
</html>
