<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AIR FORCE LIVE EXAM (Mobile Ready)</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

    <style>
        /* --- GLOBAL STYLES --- */
        * { box-sizing: border-box; }
        body { 
            margin: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: #f0f2f5; overflow: hidden; user-select: none; -webkit-user-select: none;
            touch-action: manipulation; /* Zoom disable on double tap */
        }
        
        /* --- SCREENS --- */
        #login-screen, #leaderboard-screen { 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            height: 100vh; background: linear-gradient(135deg, #0056b3, #002a4d); color: white; text-align: center;
            padding: 20px;
        }
        #exam-screen { display: none; height: 100vh; flex-direction: column; }

        /* --- LOGIN & BUTTONS --- */
        h1 { font-size: 24px; margin-bottom: 10px; }
        .g-btn { 
            background: white; color: #333; padding: 12px 25px; font-weight: bold; border: none; 
            cursor: pointer; border-radius: 50px; font-size: 16px; display: flex; align-items: center; gap: 10px; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.2); transition: transform 0.2s;
        }
        .g-btn:active { transform: scale(0.95); }

        /* --- EXAM HEADER --- */
        .header { 
            background: #fff; padding: 10px 15px; display: flex; justify-content: space-between; align-items: center;
            border-bottom: 2px solid #ddd; height: 60px;
        }
        .timer { font-size: 20px; font-weight: 800; color: #d9534f; background: #ffebeb; padding: 5px 10px; border-radius: 5px; }
        .user-badge { font-weight: bold; color: #0056b3; max-width: 100px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        /* --- MAIN EXAM AREA (Responsive Flex) --- */
        .main-area { display: flex; flex: 1; overflow: hidden; }
        
        /* Question Area */
        .question-box { 
            flex: 3; padding: 20px; background: white; overflow-y: auto; 
            display: flex; flex-direction: column;
        }
        #question-text { font-size: 18px; line-height: 1.5; margin-bottom: 20px; font-weight: 500; }
        
        .option-label {
            display: block; background: #f8f9fa; padding: 12px; margin: 8px 0; border: 1px solid #dee2e6; 
            border-radius: 8px; cursor: pointer; transition: background 0.2s; font-size: 16px;
        }
        .option-label:hover { background: #e9ecef; }
        .option-label input { margin-right: 10px; transform: scale(1.2); }

        /* Sidebar / Palette Area */
        .sidebar { 
            flex: 1; background: #f1f3f5; border-left: 1px solid #ddd; padding: 10px; 
            display: flex; flex-direction: column; min-width: 250px;
        }

        /* Question Palette Grid */
        #palette { 
            display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; 
            overflow-y: auto; max-height: 300px; padding: 5px;
        }
        .q-btn { 
            width: 100%; aspect-ratio: 1; border: 1px solid #ccc; background: white; 
            cursor: pointer; font-weight: bold; border-radius: 4px;
        }
        .q-btn.active { background: #007bff; color: white; border-color: #0056b3; }
        .q-btn.answered { background: #28a745; color: white; border-color: #1e7e34; }

        /* Subject Tabs */
        .tabs-container { display: flex; gap: 5px; margin-bottom: 10px; }
        .tab-btn { 
            flex: 1; padding: 8px; border: none; font-weight: bold; font-size: 12px; 
            border-radius: 4px; background: #e2e6ea; color: #495057;
        }
        .tab-btn.active { background: #0056b3; color: white; }
        .tab-btn.locked { opacity: 0.5; cursor: not-allowed; }

        /* Action Buttons */
        .action-bar { margin-top: auto; display: flex; gap: 10px; padding-top: 10px; }
        .btn-main { flex: 1; padding: 12px; border: none; color: white; font-weight: bold; border-radius: 5px; cursor: pointer; font-size: 14px;}
        .btn-save { background: #28a745; }
        .btn-submit { background: #dc3545; }

        /* --- MOBILE OPTIMIZATIONS (@media) --- */
        @media (max-width: 768px) {
            .main-area { flex-direction: column; } /* Stack Vertically */
            
            .question-box { 
                flex: 1; /* Take remaining space */
                padding: 15px; 
                padding-bottom: 80px; /* Space for bottom bar */
            }
            #question-text { font-size: 16px; }

            /* Mobile Bottom Bar for Navigation */
            .sidebar {
                position: fixed; bottom: 0; left: 0; width: 100%; height: auto;
                background: white; border-top: 2px solid #ccc; z-index: 100;
                padding: 10px; flex-direction: row; align-items: center; justify-content: space-between;
                box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            }
            
            /* Hide Palette by default on mobile */
            #palette-container { 
                display: none; position: fixed; bottom: 70px; left: 0; width: 100%; 
                background: white; border-top: 2px solid #0056b3; padding: 15px; 
                box-shadow: 0 -5px 15px rgba(0,0,0,0.2); border-radius: 15px 15px 0 0;
            }
            #palette-container.show { display: block; }
            
            /* Mobile Buttons */
            .mobile-controls { display: flex; width: 100%; gap: 10px; }
            .btn-toggle-palette { background: #6c757d; color: white; padding: 10px; border-radius: 5px; border: none; }
        }

        /* Leaderboard Table */
        table { width: 95%; max-width: 600px; border-collapse: collapse; margin-top: 20px; background: white; color: black; border-radius: 8px; overflow: hidden; }
        th, td { padding: 10px; text-align: left; border-bottom: 1px solid #ddd; font-size: 14px; }
        th { background: #0056b3; color: white; }
        tr:nth-child(even) { background-color: #f2f2f2; }

        /* Security Warning */
        #warning-overlay { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(220, 53, 69, 0.95); color: white; z-index: 9999; text-align: center; padding: 0 20px; flex-direction: column; justify-content: center; align-items: center; }
    </style>
</head>
<body oncontextmenu="return false;">

    <div id="login-screen">
        <div style="font-size: 50px; margin-bottom: 10px;">‚úàÔ∏è</div>
        <h1>AIR FORCE X-GROUP</h1>
        <p style="opacity: 0.8; margin-bottom: 30px;">Live Exam ‚Ä¢ Secure ‚Ä¢ Real-time</p>
        <button class="g-btn" onclick="googleLogin()">
            <img src="https://upload.wikimedia.org/wikipedia/commons/5/53/Google_%22G%22_Logo.svg" width="20"> 
            Google Login
        </button>
    </div>

    <div id="exam-screen">
        <div id="warning-overlay">
            <div style="font-size: 60px;">‚ö†Ô∏è</div>
            <h2>CHEATING DETECTED!</h2>
            <p>You switched tabs or minimized the app.</p>
            <p>Exam is terminating...</p>
        </div>

        <div class="header">
            <div class="user-badge" id="user-name">Student</div>
            <div class="timer" id="timer">45:00</div>
            <button onclick="finishExam()" style="background:red; color:white; border:none; padding:5px 10px; border-radius:4px; font-size:12px;">FINISH</button>
        </div>

        <div class="main-area">
            <div class="question-box">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                    <h3 id="subject-name" style="margin:0; color:#0056b3;">Physics</h3>
                    <span style="font-size:12px; color:gray;">Positive: +1 | Negative: 0</span>
                </div>
                
                <div id="question-text">Loading Question...</div>
                <div id="options-area">
                    </div>
            </div>

            <div id="palette-container" class="sidebar-content">
                <div class="tabs-container">
                    <button id="tab-phy" class="tab-btn active">PHYSICS</button>
                    <button id="tab-math" class="tab-btn locked">MATHS</button>
                </div>
                <p style="font-size:12px; margin:5px 0;">Question Palette:</p>
                <div id="palette"></div>
                <br>
                <button class="btn-main btn-submit" onclick="submitSection()">SUBMIT SECTION</button>
                <button class="btn-main" onclick="togglePalette()" style="background:#6c757d; margin-top:5px; width:100%; display:none;" id="close-palette-btn">CLOSE MENU</button>
            </div>

            <div class="sidebar mobile-only-bar">
                <div class="mobile-controls">
                    <button class="btn-toggle-palette" onclick="togglePalette()">‚ò∞ Q-List</button>
                    <button class="btn-main btn-save" onclick="saveNext()">SAVE & NEXT</button>
                </div>
            </div>
        </div>
    </div>

    <div id="leaderboard-screen" style="display:none;">
        <div style="font-size: 50px;">üèÜ</div>
        <h1>LEADERBOARD</h1>
        <h3 id="my-score" style="background:white; color:black; padding:5px 15px; border-radius:20px;">Your Score: ...</h3>
        <table id="rank-table">
            <thead>
                <tr>
                    <th width="15%">#</th>
                    <th>Name</th>
                    <th width="20%">Pts</th>
                </tr>
            </thead>
            <tbody id="lb-body">
                </tbody>
        </table>
        <button onclick="location.reload()" style="margin-top:20px; padding:10px 20px; background:white; color:#0056b3; border:none; border-radius:5px; font-weight:bold;">HOME</button>
    </div>

    <script>
        // --- 1. CONFIG (‡§Ø‡§π‡§æ‡§Å ‡§Ö‡§™‡§®‡•Ä API KEY ‡§°‡§æ‡§≤‡•á‡§Ç) ---
        const firebaseConfig = {
             apiKey: "AIzaSyBmsqEPUnWjjb2m4g1XgEcRrxlK_dOIDfE",
  authDomain: "revento-academy.firebaseapp.com",
  databaseURL: "https://revento-academy-default-rtdb.firebaseio.com",
  projectId: "revento-academy",
  storageBucket: "revento-academy.firebasestorage.app",
  messagingSenderId: "384071300366",
  appId: "1:384071300366:web:8a95f3ec8507bc2d3b535f",
  measurementId: "G-4L8YC6J095"
        };
        
        // Init Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const auth = firebase.auth();
        const db = firebase.database();
        let currentUser = null;

        // --- 2. EXAM DATA ---
        const questions = {
            physics: [
                { q: "SI Unit of Force (‡§¨‡§≤ ‡§ï‡§æ ‡§Æ‡§æ‡§§‡•ç‡§∞‡§ï)?", opts: ["Newton", "Joule", "Watt", "Pascal"], ans: 0 },
                { q: "Escape velocity of Earth (‡§™‡§≤‡§æ‡§Ø‡§® ‡§µ‡•á‡§ó)?", opts: ["11.2 km/s", "9.8 km/s", "15 km/s", "2.4 km/s"], ans: 0 },
                { q: "Light year measures?", opts: ["Time", "Distance", "Light", "Mass"], ans: 1 },
                { q: "Sound travels fastest in?", opts: ["Air", "Water", "Steel", "Vacuum"], ans: 2 }
            ],
            maths: [
                { q: "Value of sin(30¬∞)?", opts: ["1/2", "1/‚àö2", "‚àö3/2", "1"], ans: 0 },
                { q: "Integration of x dx?", opts: ["1", "x^2/2", "x^2", "log x"], ans: 1 },
                { q: "Log(1) is equal to?", opts: ["0", "1", "10", "Infinity"], ans: 0 },
                { q: "If A is singular matrix, |A| = ?", opts: ["1", "0", "-1", "None"], ans: 1 }
            ]
        };

        let currentSub = 'physics';
        let qIndex = 0;
        let answers = { physics: {}, maths: {} };
        let timer = 25 * 60; // 25 Mins
        let cheatingCount = 0;

        // --- 3. LOGIC ---
        
        function googleLogin() {
            const provider = new firebase.auth.GoogleAuthProvider();
            auth.signInWithPopup(provider).then((res) => {
                currentUser = res.user;
                document.getElementById('user-name').innerText = currentUser.displayName.split(' ')[0]; // Show First Name
                startExam();
            }).catch(e => alert(e.message));
        }

        function startExam() {
            // Mobile Fullscreen Request
            let docElm = document.documentElement;
            if (docElm.requestFullscreen) { docElm.requestFullscreen(); }
            
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('exam-screen').style.display = 'flex';
            
            // UI Adjustment for Mobile
            if(window.innerWidth < 768) {
                document.getElementById('palette-container').style.display = 'none'; // Initially hide palette
                document.getElementById('close-palette-btn').style.display = 'block';
            }

            loadQuestion();
            startTimer();
            activateSecurity();
        }

        function loadQuestion() {
            const data = questions[currentSub][qIndex];
            document.getElementById('question-text').innerText = `Q${qIndex+1}. ${data.q}`;
            
            const area = document.getElementById('options-area');
            area.innerHTML = '';
            
            data.opts.forEach((opt, i) => {
                const isChecked = (answers[currentSub][qIndex] === i) ? 'checked' : '';
                area.innerHTML += `
                    <label class="option-label">
                        <input type="radio" name="opt" value="${i}" ${isChecked}> ${opt}
                    </label>`;
            });
            renderPalette();
        }

        function saveNext() {
            const selected = document.querySelector('input[name="opt"]:checked');
            if (selected) {
                answers[currentSub][qIndex] = parseInt(selected.value);
            }
            
            if (qIndex < questions[currentSub].length - 1) {
                qIndex++;
                loadQuestion();
            } else {
                // If last question, just update palette but stay
                renderPalette();
                if(window.innerWidth < 768) alert("Last Question! Use 'Q-List' to Submit.");
            }
        }

        function renderPalette() {
            const p = document.getElementById('palette');
            p.innerHTML = '';
            questions[currentSub].forEach((_, i) => {
                let cls = 'q-btn';
                if(i === qIndex) cls += ' active';
                if(answers[currentSub][i] !== undefined) cls += ' answered';
                
                p.innerHTML += `<button class="${cls}" onclick="jumpToQ(${i})">${i+1}</button>`;
            });
        }

        function jumpToQ(i) {
            qIndex = i;
            loadQuestion();
            // On mobile, close palette after selection
            if(window.innerWidth < 768) togglePalette();
        }

        function togglePalette() {
            // Logic for mobile bottom sheet
            const pContainer = document.getElementById('palette-container');
            if (window.innerWidth < 768) {
                if (pContainer.style.display === 'none' || pContainer.style.display === '') {
                    pContainer.style.display = 'block';
                    pContainer.classList.add('show');
                } else {
                    pContainer.style.display = 'none';
                    pContainer.classList.remove('show');
                }
            }
        }

        function submitSection() {
            if(currentSub === 'physics') {
                if(!confirm("Submit Physics & Start Maths?")) return;
                currentSub = 'maths';
                qIndex = 0;
                document.getElementById('tab-phy').classList.remove('active');
                document.getElementById('tab-math').classList.remove('locked');
                document.getElementById('tab-math').classList.add('active');
                document.getElementById('subject-name').innerText = "Mathematics";
                loadQuestion();
                if(window.innerWidth < 768) togglePalette();
            } else {
                finishExam();
            }
        }

        function finishExam() {
            if (document.exitFullscreen) document.exitFullscreen();
            
            let score = 0;
            ['physics', 'maths'].forEach(sub => {
                questions[sub].forEach((q, i) => {
                    if (answers[sub][i] === q.ans) score++;
                });
            });

            // Save DB
            if(currentUser) {
                db.ref('leaderboard/' + currentUser.uid).set({
                    name: currentUser.displayName,
                    score: score,
                    time: new Date().toLocaleTimeString()
                });
            }

            document.getElementById('exam-screen').style.display = 'none';
            document.getElementById('leaderboard-screen').style.display = 'flex';
            document.getElementById('my-score').innerText = `Your Score: ${score}`;
            loadLeaderboard();
        }

        function loadLeaderboard() {
            db.ref('leaderboard').orderByChild('score').limitToLast(20).on('value', snap => {
                const body = document.getElementById('lb-body');
                body.innerHTML = '';
                let list = [];
                snap.forEach(c => list.push(c.val()));
                list.sort((a,b) => b.score - a.score);
                
                list.forEach((u, i) => {
                    body.innerHTML += `<tr><td>#${i+1}</td><td>${u.name}</td><td>${u.score}</td></tr>`;
                });
            });
        }

        function startTimer() {
            setInterval(() => {
                if(timer > 0) {
                    timer--;
                    let m = Math.floor(timer/60);
                    let s = timer%60;
                    document.getElementById('timer').innerText = `${m}:${s<10?'0'+s:s}`;
                } else {
                    finishExam();
                }
            }, 1000);
        }

        function activateSecurity() {
            // Visibility Check
            document.addEventListener("visibilitychange", () => {
                if(document.hidden) {
                    cheatingCount++;
                    if(cheatingCount >= 2) {
                        document.getElementById('warning-overlay').style.display = 'flex';
                        setTimeout(finishExam, 3000);
                    } else {
                        alert("WARNING: Do not switch apps! Next time exam will END.");
                    }
                }
            });
        }
    </script>
</body>
</html>
