<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Revento Academy | Live Exam Portal</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&family=Teko:wght@400;600&display=swap" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

    <style>
        :root { --brand: #306da6; --bg: #f4f6f9; }
        * { box-sizing: border-box; user-select: none; }
        body { margin: 0; font-family: 'Roboto', sans-serif; background: var(--bg); height: 100vh; display: flex; flex-direction: column; }

        /* HEADER */
        .top-bar { height: 60px; background: white; border-bottom: 3px solid var(--brand); display: flex; justify-content: space-between; align-items: center; padding: 0 30px; }
        .brand-text { font-family: 'Teko', sans-serif; font-size: 1.8rem; color: var(--brand); }

        /* LOGIN OVERLAY */
        #login-screen { position: fixed; top:0; left:0; width:100%; height:100%; background:#fff; z-index:2000; display:flex; align-items:center; justify-content:center; }
        .login-box { width: 350px; text-align: center; }
        .inp-field { padding: 12px; width: 100%; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 5px; }

        /* DASHBOARD */
        #dashboard { padding: 30px; max-width: 1000px; margin: 0 auto; width: 100%; }
        .sub-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 20px; }
        .card { background: white; padding: 20px; border-radius: 8px; border-bottom: 4px solid #ccc; cursor: pointer; transition: 0.3s; text-align: center; }
        .card:hover { transform: translateY(-5px); border-color: var(--brand); }
        .mix-card { background: var(--brand); color: white; border: none; }
        .mix-card h3 { color: white; }

        /* EXAM AREA */
        #exam-portal { display: none; height: calc(100vh - 60px); flex-direction: column; }
        .exam-body { display: flex; flex: 1; overflow: hidden; }
        .q-area { flex: 1; padding: 30px; overflow-y: auto; background: white; }
        .sidebar { width: 280px; background: #eee; border-left: 1px solid #ccc; display: flex; flex-direction: column; }
        
        .opt-row { display: flex; padding: 10px; border: 1px solid #ddd; margin-bottom: 10px; cursor: pointer; border-radius: 4px; }
        .opt-row:hover { background: #e3f2fd; }
        .opt-row input { margin-right: 15px; }

        .palette { display: grid; grid-template-columns: repeat(5, 1fr); gap: 5px; padding: 10px; overflow-y: auto; flex: 1; }
        .p-btn { height: 35px; background: white; border: 1px solid #ccc; display: flex; justify-content: center; align-items: center; cursor: pointer; font-size: 0.9rem; }
        .p-btn.done { background: #00c853; color: white; }
        .p-btn.active { border: 2px solid var(--brand); }

        /* LEADERBOARD OVERLAY */
        #lb-overlay { display: none; position: fixed; top:0; left:0; width: 100%; height:100%; background: rgba(0,0,0,0.9); z-index: 3000; align-items: center; justify-content: center; }
        .lb-box { width: 500px; background: white; border-radius: 10px; overflow: hidden; max-height: 80vh; display: flex; flex-direction: column; }
        .lb-head { background: var(--brand); color: white; padding: 15px; text-align: center; font-weight: bold; }
        .lb-list { overflow-y: auto; padding: 10px; flex: 1; }
        .lb-row { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid #eee; }
        .my-rank { background: #e3f2fd; border: 2px solid var(--brand); font-weight: bold; }

    </style>
</head>
<body>

    <div id="login-screen">
        <div class="login-box">
            <h2 style="font-family: 'Teko'; font-size: 2.5rem; color: var(--brand); margin: 0;">REVENTO ACADEMY</h2>
            <p style="color: #666;">Enter Name to Start</p>
            <input type="text" id="username" class="inp-field" placeholder="Student Name (e.g. Rahul)">
            <button onclick="login()" style="width: 100%; padding: 12px; background: var(--brand); color: white; border: none; font-weight: bold; cursor: pointer;">ENTER DASHBOARD</button>
        </div>
    </div>

    <div class="top-bar">
        <div class="brand-text">REVENTO ACADEMY</div>
        <div id="user-display" style="font-weight: bold; color: #555;">Guest</div>
    </div>

    <div id="dashboard" style="display: none;">
        <h2>üëã Select Test Subject</h2>
        <div class="sub-grid">
            <div class="card mix-card" onclick="startTest('MIX')">
                <div style="font-size: 2rem;">üöÄ</div>
                <h3>FULL MOCK TEST</h3>
                <p>All Subjects Mixed</p>
            </div>
            <div class="card" onclick="startTest('Maths')"><h3>üìê Maths</h3></div>
            <div class="card" onclick="startTest('Science')"><h3>üß¨ Science</h3></div>
            <div class="card" onclick="startTest('Social')"><h3>üåç Social Sc.</h3></div>
            <div class="card" onclick="startTest('Hindi')"><h3>üìñ Hindi</h3></div>
            <div class="card" onclick="startTest('Sanskrit')"><h3>üïâÔ∏è Sanskrit</h3></div>
        </div>
    </div>

    <div id="exam-portal">
        <div style="background: #222; color: white; padding: 10px 20px; display: flex; justify-content: space-between;">
            <span>Subject: <span id="sub-name" style="color: #4fc3f7; font-weight: bold;">MIX</span></span>
            <span>Time: <span id="timer">00:00:00</span></span>
        </div>
        <div class="exam-body">
            <div class="q-area">
                <div style="margin-bottom: 20px; font-weight: bold; color: #666;">
                    Question <span id="q-no">1</span>
                    <span id="q-sub-badge" style="background: #eee; padding: 2px 8px; border-radius: 4px; font-size: 0.8rem; margin-left: 10px;">SUB</span>
                </div>
                <div id="q-text" style="font-size: 1.3rem; margin-bottom: 20px;">Loading...</div>
                <div id="opt-area"></div>
            </div>
            <div class="sidebar">
                <div class="palette" id="palette-grid"></div>
                <button onclick="submitExam()" style="padding: 15px; background: var(--brand); color: white; border: none; font-weight: bold; cursor: pointer;">SUBMIT TEST</button>
            </div>
        </div>
    </div>

    <div id="lb-overlay">
        <div class="lb-box">
            <div class="lb-head">üèÜ LIVE LEADERBOARD</div>
            <div style="text-align: center; padding: 15px; border-bottom: 1px solid #ccc; background: #f9f9f9;">
                Score: <span id="my-final-score" style="font-size: 1.5rem; color: var(--brand); font-weight: bold;">0</span>
            </div>
            <div class="lb-list" id="lb-list">
                <div style="text-align: center; padding: 20px;">Connecting to Server...</div>
            </div>
            <button onclick="location.reload()" style="padding: 15px; border: none; background: #333; color: white; cursor: pointer;">Close & Restart</button>
        </div>
    </div>

    <script>
        // ======================================================
        // üî¥ STEP 1: FIREBASE CONFIG (Paste here)
        // ======================================================
        const firebaseConfig = {
          apiKey: "AIzaSyBmsqEPUnWjjb2m4g1XgEcRrxlK_dOIDfE",
  authDomain: "revento-academy.firebaseapp.com",
  databaseURL: "https://revento-academy-default-rtdb.firebaseio.com",
  projectId: "revento-academy",
  storageBucket: "revento-academy.firebasestorage.app",
  messagingSenderId: "384071300366",
  appId: "1:384071300366:web:8a95f3ec8507bc2d3b535f",
  measurementId: "G-4L8YC6J095"
        };

        let db;
        try {
            firebase.initializeApp(firebaseConfig);
            db = firebase.database();
        } catch(e) { console.log("Firebase not connected"); }


        // ======================================================
        // üìù MASTER QUESTION BANK (Unlimited)
        // ======================================================
        const MASTER_DB = [
            { subject: "Maths", q: "sin 90¬∞ ‡§ï‡§æ ‡§Æ‡§æ‡§® ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•à?", opts: ["0", "1", "1/2", "‚àû"], ans: 1 },
            { subject: "Maths", q: "2, 4, 6... ‡§ï‡§æ ‡§∏‡§æ‡§∞‡•ç‡§µ ‡§Ö‡§Ç‡§§‡§∞ (d) ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•à?", opts: ["1", "2", "3", "4"], ans: 1 },
            { subject: "Science", q: "‡§Æ‡§æ‡§®‡§µ ‡§∂‡§∞‡•Ä‡§∞ ‡§ï‡•Ä ‡§∏‡§¨‡§∏‡•á ‡§¨‡§°‡§º‡•Ä ‡§π‡§°‡•ç‡§°‡•Ä ‡§ï‡•å‡§® ‡§∏‡•Ä ‡§π‡•à?", opts: ["‡§´‡•Ä‡§Æ‡§∞", "‡§∏‡•ç‡§ü‡•á‡§™‡•ç‡§∏", "‡§π‡•ç‡§Ø‡•Ç‡§Æ‡§∞‡§∏", "‡§ü‡§ø‡§¨‡§ø‡§Ü"], ans: 0 },
            { subject: "Science", q: "‡§∂‡•Å‡§¶‡•ç‡§ß ‡§ú‡§≤ ‡§ï‡§æ pH ‡§Æ‡§æ‡§® ‡§ï‡§ø‡§§‡§®‡§æ ‡§π‡•ã‡§§‡§æ ‡§π‡•à?", opts: ["0", "7", "14", "10"], ans: 1 },
            { subject: "Hindi", q: "‚Äò‡§ó‡•ã‡§¶‡§æ‡§®‚Äô ‡§ï‡•á ‡§≤‡•á‡§ñ‡§ï ‡§ï‡•å‡§® ‡§π‡•à‡§Ç?", opts: ["‡§™‡•ç‡§∞‡•á‡§Æ‡§ö‡§Ç‡§¶", "‡§™‡•ç‡§∞‡§∏‡§æ‡§¶", "‡§®‡§ø‡§∞‡§æ‡§≤‡§æ", "‡§™‡§Ç‡§§"], ans: 0 },
            { subject: "Sanskrit", q: "‡§Ö‡§ß‡•ã‡§≤‡§ø‡§ñ‡§ø‡§§‡•á‡§∑‡•Å ‡§Ö‡§µ‡•ç‡§Ø‡§Ø‡§™‡§¶‡§Ç ‡§ï‡§ø‡§Æ‡•ç?", opts: ["‡§Ö‡§§‡•ç‡§∞", "‡§ó‡§ö‡•ç‡§õ‡§§‡§ø", "‡§¨‡§æ‡§≤‡§ï‡§É", "‡§≤‡§§‡§æ"], ans: 0 },
            { subject: "Social", q: "‡§≠‡§æ‡§∞‡§§ ‡§ï‡§æ ‡§∏‡§Ç‡§µ‡§ø‡§ß‡§æ‡§® ‡§ï‡§¨ ‡§≤‡§æ‡§ó‡•Ç ‡§π‡•Å‡§Ü?", opts: ["1947", "1950", "1952", "1949"], ans: 1 },
        ];

        // ======================================================
        // ‚öôÔ∏è LOGIC
        // ======================================================
        let activeQs = [];
        let userAns = [];
        let currIdx = 0;
        let userName = "Student";
        let timerInt;

        function login() {
            const n = document.getElementById('username').value;
            if(!n) return alert("Enter Name!");
            userName = n;
            document.getElementById('user-display').innerText = n;
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('dashboard').style.display = 'block';
        }

        function startTest(sub) {
            // Filter Logic
            if(sub === 'MIX') {
                activeQs = MASTER_DB;
            } else {
                activeQs = MASTER_DB.filter(q => q.subject === sub);
            }

            if(activeQs.length === 0) return alert("No questions found for " + sub);

            // Setup Exam
            userAns = new Array(activeQs.length).fill(null);
            document.getElementById('dashboard').style.display = 'none';
            document.getElementById('exam-portal').style.display = 'flex';
            document.getElementById('sub-name').innerText = sub;
            
            // Fullscreen
            document.documentElement.requestFullscreen().catch(e=>{});

            renderPalette();
            loadQ(0);
            
            // Timer (Demo: 30 mins)
            let t = 30 * 60;
            timerInt = setInterval(() => {
                let m = Math.floor(t/60);
                let s = t%60;
                document.getElementById('timer').innerText = `${m}:${s<10?'0'+s:s}`;
                if(t<=0) submitExam();
                t--;
            }, 1000);
        }

        function loadQ(idx) {
            currIdx = idx;
            const q = activeQs[idx];
            document.getElementById('q-no').innerText = idx+1;
            document.getElementById('q-sub-badge').innerText = q.subject;
            document.getElementById('q-text').innerText = q.q;

            const area = document.getElementById('opt-area');
            area.innerHTML = "";
            q.opts.forEach((opt, i) => {
                let check = userAns[idx] === i ? 'checked' : '';
                area.innerHTML += `
                    <label class="opt-row">
                        <input type="radio" name="opt" onclick="saveAns(${i})" ${check}> ${opt}
                    </label>
                `;
            });
            updatePalette();
        }

        function saveAns(i) {
            userAns[currIdx] = i;
            updatePalette();
        }

        function renderPalette() {
            const g = document.getElementById('palette-grid');
            g.innerHTML = "";
            activeQs.forEach((_, i) => g.innerHTML += `<div class="p-btn" id="p-${i}" onclick="loadQ(${i})">${i+1}</div>`);
        }

        function updatePalette() {
            activeQs.forEach((_, i) => {
                const b = document.getElementById(`p-${i}`);
                b.className = "p-btn";
                if(userAns[i] !== null) b.classList.add('done');
                if(i === currIdx) b.classList.add('active');
            });
        }

        // --- SUBMIT & LEADERBOARD ---
        function submitExam() {
            clearInterval(timerInt);
            let score = 0;
            userAns.forEach((a, i) => { if(a === activeQs[i].ans) score++; });

            // Show Result
            document.getElementById('lb-overlay').style.display = 'flex';
            document.getElementById('my-final-score').innerText = `${score} / ${activeQs.length}`;

            // Send to Firebase
            if(db) {
                const uid = Date.now();
                db.ref('leaderboard/' + uid).set({
                    name: userName,
                    score: score,
                    subject: document.getElementById('sub-name').innerText,
                    time: new Date().toLocaleTimeString()
                });
                fetchLB();
            } else {
                document.getElementById('lb-list').innerHTML = "<div style='text-align:center; padding:20px; color:red;'>Firebase Not Configured!</div>";
            }
        }

        function fetchLB() {
            const list = document.getElementById('lb-list');
            list.innerHTML = "Loading...";
            
            // Get Top 20 Scores
            db.ref('leaderboard').orderByChild('score').limitToLast(20).on('value', (snap) => {
                let data = [];
                snap.forEach(c => data.push(c.val()));
                data.sort((a,b) => b.score - a.score); // High to Low

                list.innerHTML = "";
                data.forEach((p, i) => {
                    let style = p.name === userName ? "my-rank" : "";
                    list.innerHTML += `
                        <div class="lb-row ${style}">
                            <div>#${i+1} ${p.name} <small style='color:#777'>(${p.subject})</small></div>
                            <div style="font-weight:bold; color:var(--brand)">${p.score}</div>
                        </div>
                    `;
                });
            });
        }

    </script>
</body>
</html>
