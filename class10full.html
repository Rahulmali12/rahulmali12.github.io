<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Revento Academy | Live Exam Portal</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&family=Teko:wght@400;600&display=swap" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

    <style>
        :root { --brand: #306da6; --bg: #f4f6f9; }
        * { box-sizing: border-box; user-select: none; }
        body { margin: 0; font-family: 'Roboto', sans-serif; background: var(--bg); height: 100vh; display: flex; flex-direction: column; }

        /* HEADER */
        .top-bar { height: 60px; background: white; border-bottom: 3px solid var(--brand); display: flex; justify-content: space-between; align-items: center; padding: 0 30px; }
        .brand-text { font-family: 'Teko', sans-serif; font-size: 1.8rem; color: var(--brand); }

        /* LOGIN OVERLAY */
        #login-screen { position: fixed; top:0; left:0; width:100%; height:100%; background:#fff; z-index:2000; display:flex; align-items:center; justify-content:center; }
        .login-box { width: 350px; text-align: center; }
        .inp-field { padding: 12px; width: 100%; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 5px; }

        /* DASHBOARD */
        #dashboard { padding: 30px; max-width: 1000px; margin: 0 auto; width: 100%; }
        .sub-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 20px; }
        .card { background: white; padding: 20px; border-radius: 8px; border-bottom: 4px solid #ccc; cursor: pointer; transition: 0.3s; text-align: center; }
        .card:hover { transform: translateY(-5px); border-color: var(--brand); }
        .mix-card { background: var(--brand); color: white; border: none; }
        .mix-card h3 { color: white; }

        /* EXAM AREA */
        #exam-portal { display: none; height: calc(100vh - 60px); flex-direction: column; }
        .exam-body { display: flex; flex: 1; overflow: hidden; }
        .q-area { flex: 1; padding: 30px; overflow-y: auto; background: white; }
        .sidebar { width: 280px; background: #eee; border-left: 1px solid #ccc; display: flex; flex-direction: column; }
        
        .opt-row { display: flex; padding: 10px; border: 1px solid #ddd; margin-bottom: 10px; cursor: pointer; border-radius: 4px; }
        .opt-row:hover { background: #e3f2fd; }
        .opt-row input { margin-right: 15px; }

        .palette { display: grid; grid-template-columns: repeat(5, 1fr); gap: 5px; padding: 10px; overflow-y: auto; flex: 1; }
        .p-btn { height: 35px; background: white; border: 1px solid #ccc; display: flex; justify-content: center; align-items: center; cursor: pointer; font-size: 0.9rem; }
        .p-btn.done { background: #00c853; color: white; }
        .p-btn.active { border: 2px solid var(--brand); }

        /* LEADERBOARD OVERLAY */
        #lb-overlay { display: none; position: fixed; top:0; left:0; width: 100%; height:100%; background: rgba(0,0,0,0.9); z-index: 3000; align-items: center; justify-content: center; }
        .lb-box { width: 500px; background: white; border-radius: 10px; overflow: hidden; max-height: 80vh; display: flex; flex-direction: column; }
        .lb-head { background: var(--brand); color: white; padding: 15px; text-align: center; font-weight: bold; }
        .lb-list { overflow-y: auto; padding: 10px; flex: 1; }
        .lb-row { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid #eee; }
        .my-rank { background: #e3f2fd; border: 2px solid var(--brand); font-weight: bold; }

    </style>
</head>
<body>

    <div id="login-screen">
        <div class="login-box">
            <h2 style="font-family: 'Teko'; font-size: 2.5rem; color: var(--brand); margin: 0;">REVENTO ACADEMY</h2>
            <p style="color: #666;">Enter Name to Start</p>
            <input type="text" id="username" class="inp-field" placeholder="Student Name (e.g. Rahul)">
            <button onclick="login()" style="width: 100%; padding: 12px; background: var(--brand); color: white; border: none; font-weight: bold; cursor: pointer;">ENTER DASHBOARD</button>
        </div>
    </div>

    <div class="top-bar">
        <div class="brand-text">REVENTO ACADEMY</div>
        <div id="user-display" style="font-weight: bold; color: #555;">Guest</div>
    </div>

    <div id="dashboard" style="display: none;">
        <h2>üëã Select Test Subject</h2>
        <div class="sub-grid">
            <div class="card mix-card" onclick="startTest('MIX')">
                <div style="font-size: 2rem;">üöÄ</div>
                <h3>FULL MOCK TEST</h3>
                <p>All Subjects Mixed</p>
            </div>
            <div class="card" onclick="startTest('Maths')"><h3>üìê Maths</h3></div>
            <div class="card" onclick="startTest('Science')"><h3>üß¨ Science</h3></div>
            <div class="card" onclick="startTest('Social')"><h3>üåç Social Sc.</h3></div>
            <div class="card" onclick="startTest('Hindi')"><h3>üìñ Hindi</h3></div>
            <div class="card" onclick="startTest('Sanskrit')"><h3>üïâÔ∏è Sanskrit</h3></div>
        </div>
    </div>

    <div id="exam-portal">
        <div style="background: #222; color: white; padding: 10px 20px; display: flex; justify-content: space-between;">
            <span>Subject: <span id="sub-name" style="color: #4fc3f7; font-weight: bold;">MIX</span></span>
            <span>Time: <span id="timer">00:00:00</span></span>
        </div>
        <div class="exam-body">
            <div class="q-area">
                <div style="margin-bottom: 20px; font-weight: bold; color: #666;">
                    Question <span id="q-no">1</span>
                    <span id="q-sub-badge" style="background: #eee; padding: 2px 8px; border-radius: 4px; font-size: 0.8rem; margin-left: 10px;">SUB</span>
                </div>
                <div id="q-text" style="font-size: 1.3rem; margin-bottom: 20px;">Loading...</div>
                <div id="opt-area"></div>
            </div>
            <div class="sidebar">
                <div class="palette" id="palette-grid"></div>
                <button onclick="submitExam()" style="padding: 15px; background: var(--brand); color: white; border: none; font-weight: bold; cursor: pointer;">SUBMIT TEST</button>
            </div>
        </div>
    </div>

    <div id="lb-overlay">
        <div class="lb-box">
            <div class="lb-head">üèÜ LIVE LEADERBOARD</div>
            <div style="text-align: center; padding: 15px; border-bottom: 1px solid #ccc; background: #f9f9f9;">
                Score: <span id="my-final-score" style="font-size: 1.5rem; color: var(--brand); font-weight: bold;">0</span>
            </div>
            <div class="lb-list" id="lb-list">
                <div style="text-align: center; padding: 20px;">Connecting to Server...</div>
            </div>
            <button onclick="location.reload()" style="padding: 15px; border: none; background: #333; color: white; cursor: pointer;">Close & Restart</button>
        </div>
    </div>

    <script>
        // ======================================================
        // üî¥ STEP 1: FIREBASE CONFIG (Paste here)
        // ======================================================
        const firebaseConfig = {
          apiKey: "AIzaSyBmsqEPUnWjjb2m4g1XgEcRrxlK_dOIDfE",
  authDomain: "revento-academy.firebaseapp.com",
  databaseURL: "https://revento-academy-default-rtdb.firebaseio.com",
  projectId: "revento-academy",
  storageBucket: "revento-academy.firebasestorage.app",
  messagingSenderId: "384071300366",
  appId: "1:384071300366:web:8a95f3ec8507bc2d3b535f",
  measurementId: "G-4L8YC6J095"
        };

        let db;
        try {
            firebase.initializeApp(firebaseConfig);
            db = firebase.database();
        } catch(e) { console.log("Firebase not connected"); }


        // ======================================================
        // üìù MASTER QUESTION BANK (Unlimited)
        // ======================================================
        const MASTER_DB = [
            { subject: "Maths", q: "sin 90¬∞ ‡§ï‡§æ ‡§Æ‡§æ‡§® ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•à?", opts: ["0", "1", "1/2", "‚àû"], ans: 1 },
            { subject: "Maths", q: "2, 4, 6... ‡§ï‡§æ ‡§∏‡§æ‡§∞‡•ç‡§µ ‡§Ö‡§Ç‡§§‡§∞ (d) ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•à?", opts: ["1", "2", "3", "4"], ans: 1 },
    { subject: "Science", q: "‡§™‡§æ‡§®‡•Ä ‡§ï‡§æ ‡§∞‡§æ‡§∏‡§æ‡§Ø‡§®‡§ø‡§ï ‡§∏‡•Ç‡§§‡•ç‡§∞ ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•à?", opts: ["H2O", "CO2", "O2", "HCl"], ans: 0 },
    { subject: "Science", q: "‡§µ‡§æ‡§Ø‡•Å ‡§Æ‡•á‡§Ç ‡§∏‡§¨‡§∏‡•á ‡§Ö‡§ß‡§ø‡§ï ‡§ï‡•å‡§®-‡§∏‡•Ä ‡§ó‡•à‡§∏ ‡§™‡§æ‡§à ‡§ú‡§æ‡§§‡•Ä ‡§π‡•à?", opts: ["‡§ë‡§ï‡•ç‡§∏‡•Ä‡§ú‡§®", "‡§π‡§æ‡§á‡§°‡•ç‡§∞‡•ã‡§ú‡§®", "‡§®‡§æ‡§á‡§ü‡•ç‡§∞‡•ã‡§ú‡§®", "‡§ï‡§æ‡§∞‡•ç‡§¨‡§® ‡§°‡§æ‡§á‡§ë‡§ï‡•ç‡§∏‡§æ‡§á‡§°"], ans: 2 },
    { subject: "Science", q: "‡§Æ‡§æ‡§®‡§µ ‡§∂‡§∞‡•Ä‡§∞ ‡§Æ‡•á‡§Ç ‡§∞‡§ï‡•ç‡§§ ‡§ï‡•ã ‡§™‡§Ç‡§™ ‡§ï‡•å‡§® ‡§ï‡§∞‡§§‡§æ ‡§π‡•à?", opts: ["‡§´‡•á‡§´‡§°‡§º‡•á", "‡§π‡•É‡§¶‡§Ø", "‡§Ø‡§ï‡•É‡§§", "‡§Æ‡§∏‡•ç‡§§‡§ø‡§∑‡•ç‡§ï"], ans: 1 },
    { subject: "Science", q: "‡§™‡•å‡§ß‡•á ‡§≠‡•ã‡§ú‡§® ‡§ï‡§ø‡§∏ ‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§∏‡•á ‡§¨‡§®‡§æ‡§§‡•á ‡§π‡•à‡§Ç?", opts: ["‡§∂‡•ç‡§µ‡§∏‡§®", "‡§™‡§æ‡§ö‡§®", "‡§™‡•ç‡§∞‡§ï‡§æ‡§∂ ‡§∏‡§Ç‡§∂‡•ç‡§≤‡•á‡§∑‡§£", "‡§â‡§§‡•ç‡§∏‡§∞‡•ç‡§ú‡§®"], ans: 2 },
    { subject: "Science", q: "NaCl ‡§ï‡•ã ‡§ï‡•ç‡§Ø‡§æ ‡§ï‡§π‡§§‡•á ‡§π‡•à‡§Ç?", opts: ["‡§ö‡•Ä‡§®‡•Ä", "‡§®‡§Æ‡§ï", "‡§ï‡•à‡§≤‡•ç‡§∂‡§ø‡§Ø‡§Æ", "‡§Ö‡§Æ‡•ã‡§®‡§ø‡§Ø‡§æ"], ans: 1 },
    { subject: "Science", q: "‡§ú‡§Æ‡•Ä‡§® ‡§∏‡•á ‡§ä‡§™‡§∞ ‡§ï‡•Ä ‡§ì‡§∞ ‡§´‡•á‡§Ç‡§ï‡•Ä ‡§ó‡§à ‡§µ‡§∏‡•ç‡§§‡•Å ‡§™‡§∞ ‡§ï‡•å‡§®-‡§∏‡§æ ‡§¨‡§≤ ‡§≤‡§ó‡§§‡§æ ‡§π‡•à?", opts: ["‡§ò‡§∞‡•ç‡§∑‡§£ ‡§¨‡§≤", "‡§ö‡•Å‡§Ç‡§¨‡§ï‡•Ä‡§Ø ‡§¨‡§≤", "‡§ó‡•Å‡§∞‡•Å‡§§‡•ç‡§µ‡§æ‡§ï‡§∞‡•ç‡§∑‡§£ ‡§¨‡§≤", "‡§µ‡§ø‡§¶‡•ç‡§Ø‡•Å‡§§ ‡§¨‡§≤"], ans: 2 },
    { subject: "Science", q: "‡§ß‡§æ‡§§‡•Å ‡§ï‡§æ ‡§∏‡•ç‡§µ‡§≠‡§æ‡§µ ‡§ï‡•à‡§∏‡§æ ‡§π‡•ã‡§§‡§æ ‡§π‡•à?", opts: ["‡§≠‡§Ç‡§ó‡•Å‡§∞", "‡§µ‡§ø‡§¶‡•ç‡§Ø‡•Å‡§§ ‡§ö‡§æ‡§≤‡§ï", "‡§ó‡•à‡§∞ ‡§ö‡§æ‡§≤‡§ï", "‡§™‡§æ‡§∞‡§¶‡§∞‡•ç‡§∂‡•Ä"], ans: 1 },
    { subject: "Science", q: "‡§™‡•ç‡§∞‡§ï‡§æ‡§∂ ‡§ï‡•Ä ‡§ó‡§§‡§ø ‡§∏‡§¨‡§∏‡•á ‡§Ö‡§ß‡§ø‡§ï ‡§ï‡§π‡§æ‡§Å ‡§π‡•ã‡§§‡•Ä ‡§π‡•à?", opts: ["‡§ú‡§≤ ‡§Æ‡•á‡§Ç", "‡§ï‡§æ‡§Å‡§ö ‡§Æ‡•á‡§Ç", "‡§®‡§ø‡§∞‡•ç‡§µ‡§æ‡§§ ‡§Æ‡•á‡§Ç", "‡§π‡§µ‡§æ ‡§Æ‡•á‡§Ç"], ans: 2 },
    { subject: "Science", q: "‡§≤‡•á‡§Ç‡§∏ ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§ø‡§∏‡§Æ‡•á‡§Ç ‡§π‡•ã‡§§‡§æ ‡§π‡•à?", opts: ["‡§ò‡§°‡§º‡•Ä", "‡§ü‡•á‡§≤‡•Ä‡§µ‡§ø‡§ú‡§®", "‡§Æ‡§æ‡§á‡§ï‡•ç‡§∞‡•ã‡§∏‡•ç‡§ï‡•ã‡§™", "‡§∞‡•á‡§°‡§ø‡§Ø‡•ã"], ans: 2 },
    { subject: "Science", q: "Fe ‡§ï‡§ø‡§∏ ‡§§‡§§‡•ç‡§µ ‡§ï‡§æ ‡§™‡•ç‡§∞‡§§‡•Ä‡§ï ‡§π‡•à?", opts: ["‡§§‡§æ‡§Ç‡§¨‡§æ", "‡§≤‡•ã‡§π‡§æ", "‡§ö‡§æ‡§Ç‡§¶‡•Ä", "‡§∏‡•Ä‡§∏‡§æ"], ans: 1 },
    { subject: "Science", q: "‡§µ‡§ø‡§¶‡•ç‡§Ø‡•Å‡§§ ‡§ß‡§æ‡§∞‡§æ ‡§ï‡•Ä SI ‡§á‡§ï‡§æ‡§à ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•à?", opts: ["‡§ú‡•Ç‡§≤", "‡§è‡§Æ‡•ç‡§™‡§ø‡§Ø‡§∞", "‡§µ‡•ã‡§≤‡•ç‡§ü", "‡§ì‡§Æ"], ans: 1 },
    { subject: "Science", q: "Greenhouse effect ‡§ï‡•á ‡§ï‡§æ‡§∞‡§£ ‡§ï‡•å‡§®-‡§∏‡•Ä ‡§ó‡•à‡§∏ ‡§ú‡§ø‡§Æ‡•ç‡§Æ‡•á‡§¶‡§æ‡§∞ ‡§π‡•à?", opts: ["O2", "CO2", "N2", "H2"], ans: 1 },
    { subject: "Science", q: "‡§Æ‡§æ‡§®‡§µ ‡§∂‡§∞‡•Ä‡§∞ ‡§ï‡•Ä ‡§∏‡§¨‡§∏‡•á ‡§¨‡§°‡§º‡•Ä ‡§π‡§°‡•ç‡§°‡•Ä?", opts: ["‡§∞‡•Ä‡§¢‡§º", "‡§ú‡§æ‡§Ç‡§ò ‡§ï‡•Ä ‡§π‡§°‡•ç‡§°‡•Ä", "‡§¨‡§æ‡§Ç‡§π ‡§ï‡•Ä ‡§π‡§°‡•ç‡§°‡•Ä", "‡§ï‡§Ç‡§ß‡§æ"], ans: 1 },
    { subject: "Science", q: "‡§¨‡§≤ = ?", opts: ["‡§¶‡•ç‡§∞‡§µ‡•ç‡§Ø‡§Æ‡§æ‡§® √ó ‡§§‡•ç‡§µ‡§∞‡§£", "‡§¶‡•Ç‡§∞‡•Ä √ó ‡§∏‡§Æ‡§Ø", "‡§ï‡§æ‡§∞‡•ç‡§Ø √ó ‡§∂‡§ï‡•ç‡§§‡§ø", "‡§ä‡§∞‡•ç‡§ú‡§æ √ó ‡§∏‡§Æ‡§Ø"], ans: 0 },
    { subject: "Science", q: "‡§ï‡§ø‡§∏‡•á universal solvent ‡§ï‡§π‡§§‡•á ‡§π‡•à‡§Ç?", opts: ["‡§Ö‡§≤‡•ç‡§ï‡•ã‡§π‡§≤", "‡§§‡•á‡§≤", "‡§™‡§æ‡§®‡•Ä", "‡§Ö‡§Æ‡•ç‡§≤"], ans: 2 },
    { subject: "Science", q: "‡§µ‡§ø‡§¶‡•ç‡§Ø‡•Å‡§§ ‡§ä‡§∞‡•ç‡§ú‡§æ ‡§ï‡•Ä ‡§á‡§ï‡§æ‡§à?", opts: ["‡§µ‡§æ‡§ü-‡§ò‡§Ç‡§ü‡§æ", "‡§è‡§Æ‡•ç‡§™‡§ø‡§Ø‡§∞", "‡§ì‡§Æ", "‡§ú‡•Ç‡§≤-‡§Æ‡•Ä‡§ü‡§∞"], ans: 0 },
    { subject: "Science", q: "‡§π‡•É‡§¶‡§Ø ‡§ï‡§ø‡§§‡§®‡•á ‡§ï‡§ï‡•ç‡§∑‡•ã‡§Ç ‡§ï‡§æ ‡§¨‡§®‡§æ ‡§π‡•ã‡§§‡§æ ‡§π‡•à?", opts: ["2", "3", "4", "5"], ans: 2 },
    { subject: "Science", q: "DNA ‡§ï‡§π‡§æ‡§Å ‡§™‡§æ‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à?", opts: ["‡§∞‡§æ‡§á‡§¨‡•ã‡§∏‡•ã‡§Æ", "‡§®‡•ç‡§Ø‡•Ç‡§ï‡•ç‡§≤‡§ø‡§Ø‡§∏", "‡§∏‡§æ‡§á‡§ü‡•ã‡§™‡•ç‡§≤‡§æ‡§ú‡•ç‡§Æ", "‡§ï‡•ã‡§∂‡§ø‡§ï‡§æ ‡§≠‡§ø‡§§‡•ç‡§§‡§ø"], ans: 1 },
    { subject: "Science", q: "‡§Ö‡§Æ‡•ç‡§≤ ‡§ï‡§æ ‡§∏‡•ç‡§µ‡§æ‡§¶ ‡§ï‡•à‡§∏‡§æ ‡§π‡•ã‡§§‡§æ ‡§π‡•à?", opts: ["‡§Æ‡•Ä‡§†‡§æ", "‡§ñ‡§ü‡•ç‡§ü‡§æ", "‡§ï‡§°‡§º‡§µ‡§æ", "‡§ñ‡§æ‡§∞‡§æ"], ans: 1 },
    { subject: "Science", q: "‡§ì‡§ú‡•ã‡§® ‡§™‡§∞‡§§ ‡§ï‡§ø‡§∏‡•á ‡§∞‡•ã‡§ï‡§§‡•Ä ‡§π‡•à?", opts: ["‡§∞‡•á‡§°‡§ø‡§Ø‡•ã ‡§§‡§∞‡§Ç‡§ó‡•á‡§Ç", "‡§è‡§ï‡•ç‡§∏-‡§∞‡•á", "UV ‡§ï‡§ø‡§∞‡§£‡•á‡§Ç", "‡§ß‡•ç‡§µ‡§®‡§ø ‡§§‡§∞‡§Ç‡§ó‡•á‡§Ç"], ans: 2 },
    { subject: "Science", q: "‡§∂‡•ç‡§µ‡§∏‡§® ‡§Æ‡•á‡§Ç ‡§ï‡•å‡§®-‡§∏‡•Ä ‡§ó‡•à‡§∏ ‡§≤‡•Ä ‡§ú‡§æ‡§§‡•Ä ‡§π‡•à?", opts: ["‡§®‡§æ‡§á‡§ü‡•ç‡§∞‡•ã‡§ú‡§®", "‡§ë‡§ï‡•ç‡§∏‡•Ä‡§ú‡§®", "‡§ï‡§æ‡§∞‡•ç‡§¨‡§® ‡§°‡§æ‡§á‡§ë‡§ï‡•ç‡§∏‡§æ‡§á‡§°", "‡§π‡§æ‡§á‡§°‡•ç‡§∞‡•ã‡§ú‡§®"], ans: 1 },
    { subject: "Science", q: "pH 7 ‡§ï‡§æ ‡§Æ‡§§‡§≤‡§¨ ‡§π‡•à?", opts: ["‡§Ö‡§Æ‡•ç‡§≤‡•Ä‡§Ø", "‡§ï‡•ç‡§∑‡§æ‡§∞‡•Ä‡§Ø", "‡§§‡§ü‡§∏‡•ç‡§•", "‡§Ö‡§§‡•ç‡§Ø‡§ß‡§ø‡§ï ‡§Ö‡§Æ‡•ç‡§≤‡•Ä‡§Ø"], ans: 2 },
    { subject: "Science", q: "‡§¶‡§∞‡•ç‡§™‡§£ ‡§Æ‡•á‡§Ç ‡§¨‡§®‡§®‡•á ‡§µ‡§æ‡§≤‡•Ä ‡§õ‡§µ‡§ø ‡§π‡•ã‡§§‡•Ä ‡§π‡•à?", opts: ["‡§Ü‡§≠‡§æ‡§∏‡•Ä", "‡§µ‡§æ‡§∏‡•ç‡§§‡§µ‡§ø‡§ï", "‡§¶‡•ã‡§®‡•ã‡§Ç ‡§π‡•ã ‡§∏‡§ï‡§§‡•Ä ‡§π‡•à", "‡§ï‡•Å‡§õ ‡§®‡§π‡•Ä‡§Ç"], ans: 2 },
    { subject: "Science", q: "Energy ‡§ï‡§æ SI unit?", opts: ["‡§µ‡§æ‡§ü", "‡§ú‡•Ç‡§≤", "‡§®‡•ç‡§Ø‡•Ç‡§ü‡§®", "‡§Æ‡•Ä‡§ü‡§∞"], ans: 1 },
    { subject: "Science", q: "‡§ó‡•ç‡§∞‡§π‡§Æ‡§Ç‡§°‡§≤ ‡§ï‡§æ ‡§∏‡§¨‡§∏‡•á ‡§¨‡§°‡§º‡§æ ‡§ó‡•ç‡§∞‡§π?", opts: ["‡§™‡•É‡§•‡•ç‡§µ‡•Ä", "‡§Æ‡§Ç‡§ó‡§≤", "‡§∂‡§®‡§ø", "‡§¨‡•É‡§π‡§∏‡•ç‡§™‡§§‡§ø"], ans: 3 },
            { subject: "Hindi", q: "‚Äò‡§ó‡•ã‡§¶‡§æ‡§®‚Äô ‡§ï‡•á ‡§≤‡•á‡§ñ‡§ï ‡§ï‡•å‡§® ‡§π‡•à‡§Ç?", opts: ["‡§™‡•ç‡§∞‡•á‡§Æ‡§ö‡§Ç‡§¶", "‡§™‡•ç‡§∞‡§∏‡§æ‡§¶", "‡§®‡§ø‡§∞‡§æ‡§≤‡§æ", "‡§™‡§Ç‡§§"], ans: 0 },
            { subject: "Sanskrit", q: "‡§Ö‡§ß‡•ã‡§≤‡§ø‡§ñ‡§ø‡§§‡•á‡§∑‡•Å ‡§Ö‡§µ‡•ç‡§Ø‡§Ø‡§™‡§¶‡§Ç ‡§ï‡§ø‡§Æ‡•ç?", opts: ["‡§Ö‡§§‡•ç‡§∞", "‡§ó‡§ö‡•ç‡§õ‡§§‡§ø", "‡§¨‡§æ‡§≤‡§ï‡§É", "‡§≤‡§§‡§æ"], ans: 0 },
            { subject: "Social", q: "‡§≠‡§æ‡§∞‡§§ ‡§ï‡§æ ‡§∏‡§Ç‡§µ‡§ø‡§ß‡§æ‡§® ‡§ï‡§¨ ‡§≤‡§æ‡§ó‡•Ç ‡§π‡•Å‡§Ü?", opts: ["1947", "1950", "1952", "1949"], ans: 1 },
        ];

        // ======================================================
        // ‚öôÔ∏è LOGIC
        // ======================================================
        let activeQs = [];
        let userAns = [];
        let currIdx = 0;
        let userName = "Student";
        let timerInt;

        function login() {
            const n = document.getElementById('username').value;
            if(!n) return alert("Enter Name!");
            userName = n;
            document.getElementById('user-display').innerText = n;
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('dashboard').style.display = 'block';
        }

        function startTest(sub) {
            // Filter Logic
            if(sub === 'MIX') {
                activeQs = MASTER_DB;
            } else {
                activeQs = MASTER_DB.filter(q => q.subject === sub);
            }

            if(activeQs.length === 0) return alert("No questions found for " + sub);

            // Setup Exam
            userAns = new Array(activeQs.length).fill(null);
            document.getElementById('dashboard').style.display = 'none';
            document.getElementById('exam-portal').style.display = 'flex';
            document.getElementById('sub-name').innerText = sub;
            
            // Fullscreen
            document.documentElement.requestFullscreen().catch(e=>{});

            renderPalette();
            loadQ(0);
            
            // Timer (Demo: 30 mins)
            let t = 30 * 60;
            timerInt = setInterval(() => {
                let m = Math.floor(t/60);
                let s = t%60;
                document.getElementById('timer').innerText = `${m}:${s<10?'0'+s:s}`;
                if(t<=0) submitExam();
                t--;
            }, 1000);
        }

        function loadQ(idx) {
            currIdx = idx;
            const q = activeQs[idx];
            document.getElementById('q-no').innerText = idx+1;
            document.getElementById('q-sub-badge').innerText = q.subject;
            document.getElementById('q-text').innerText = q.q;

            const area = document.getElementById('opt-area');
            area.innerHTML = "";
            q.opts.forEach((opt, i) => {
                let check = userAns[idx] === i ? 'checked' : '';
                area.innerHTML += `
                    <label class="opt-row">
                        <input type="radio" name="opt" onclick="saveAns(${i})" ${check}> ${opt}
                    </label>
                `;
            });
            updatePalette();
        }

        function saveAns(i) {
            userAns[currIdx] = i;
            updatePalette();
        }

        function renderPalette() {
            const g = document.getElementById('palette-grid');
            g.innerHTML = "";
            activeQs.forEach((_, i) => g.innerHTML += `<div class="p-btn" id="p-${i}" onclick="loadQ(${i})">${i+1}</div>`);
        }

        function updatePalette() {
            activeQs.forEach((_, i) => {
                const b = document.getElementById(`p-${i}`);
                b.className = "p-btn";
                if(userAns[i] !== null) b.classList.add('done');
                if(i === currIdx) b.classList.add('active');
            });
        }

        // --- SUBMIT & LEADERBOARD ---
        function submitExam() {
            clearInterval(timerInt);
            let score = 0;
            userAns.forEach((a, i) => { if(a === activeQs[i].ans) score++; });

            // Show Result
            document.getElementById('lb-overlay').style.display = 'flex';
            document.getElementById('my-final-score').innerText = `${score} / ${activeQs.length}`;

            // Send to Firebase
            if(db) {
                const uid = Date.now();
                db.ref('leaderboard/' + uid).set({
                    name: userName,
                    score: score,
                    subject: document.getElementById('sub-name').innerText,
                    time: new Date().toLocaleTimeString()
                });
                fetchLB();
            } else {
                document.getElementById('lb-list').innerHTML = "<div style='text-align:center; padding:20px; color:red;'>Firebase Not Configured!</div>";
            }
        }

        function fetchLB() {
            const list = document.getElementById('lb-list');
            list.innerHTML = "Loading...";
            
            // Get Top 20 Scores
            db.ref('leaderboard').orderByChild('score').limitToLast(20).on('value', (snap) => {
                let data = [];
                snap.forEach(c => data.push(c.val()));
                data.sort((a,b) => b.score - a.score); // High to Low

                list.innerHTML = "";
                data.forEach((p, i) => {
                    let style = p.name === userName ? "my-rank" : "";
                    list.innerHTML += `
                        <div class="lb-row ${style}">
                            <div>#${i+1} ${p.name} <small style='color:#777'>(${p.subject})</small></div>
                            <div style="font-weight:bold; color:var(--brand)">${p.score}</div>
                        </div>
                    `;
                });
            });
        }

    </script>
</body>
</html>
